<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</title>

  <style>
    :root{
      --bg:#f4f8f5;
      --card:#ffffff;
      --muted:#6b7280;
      --text:#111827;
      --green:#66b887;
      --green2:#2f7a57;
      --line:#e6efe9;
      --soft:#eef7f1;
      --shadow:0 18px 40px rgba(17,24,39,.08);
      --radius:22px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, #edf7f0 0%, var(--bg) 55%, #f7fbf8 100%);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:0 auto;padding:26px 18px 70px}
    .brand{
      display:flex;align-items:center;gap:14px;margin-bottom:18px
    }
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:linear-gradient(145deg,#e7f6ee,#ffffff);
      box-shadow:0 10px 24px rgba(17,24,39,.10);
      display:grid;place-items:center;font-size:22px
    }
    h1{margin:0;font-size:44px;letter-spacing:-.02em;color:#1f513b}
    .sub{margin:8px 0 0;color:var(--muted);font-size:18px;line-height:1.4}

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:26px;
      border:1px solid rgba(230,239,233,.65);
      margin-top:18px;
    }
    .card h2{margin:0 0 14px;font-size:34px;letter-spacing:-.02em}
    .hint{color:var(--muted);margin:0 0 18px;font-size:16px;line-height:1.5}

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
    }
    @media (max-width:760px){
      h1{font-size:34px}
      .card h2{font-size:28px}
      .grid{grid-template-columns:1fr}
    }

    .field{
      background:#fbfdfc;
      border:1px solid var(--line);
      border-radius:18px;
      padding:12px 14px;
      display:flex;
      align-items:center;
      gap:12px;
      transition:.15s ease;
    }
    .field:focus-within{border-color:#cfe7d8; box-shadow:0 0 0 4px rgba(102,184,135,.14)}
    .icon{
      width:34px;height:34px;border-radius:14px;
      background:linear-gradient(145deg,#eaf7f0,#ffffff);
      border:1px solid #dcefe3;
      display:grid;place-items:center;
      color:#1f513b;
      flex:0 0 auto;
      font-size:18px;
    }
    label{display:block;font-size:14px;color:var(--muted);margin:0 0 6px}
    .field .ctrl{flex:1}
    input,select,textarea{
      width:100%;
      border:none;
      outline:none;
      background:transparent;
      font-size:18px;
      color:var(--text);
      padding:2px 0;
    }
    textarea{min-height:84px;resize:vertical}

    .btnRow{display:flex;gap:14px;flex-wrap:wrap;margin-top:18px}
    .btn{
      appearance:none;border:none;cursor:pointer;
      padding:16px 18px;border-radius:18px;
      font-size:18px;font-weight:700;
      transition:.15s ease;
      display:inline-flex;align-items:center;justify-content:center;gap:10px;
    }
    .btnPrimary{
      width:100%;
      background:linear-gradient(135deg,var(--green),#7bd1a0);
      color:#fff;
      box-shadow:0 14px 28px rgba(102,184,135,.25);
    }
    .btnPrimary:hover{transform:translateY(-1px)}
    .btnGhost{
      background:linear-gradient(135deg,#eaf7f0,#ffffff);
      border:1px solid #dcefe3;
      color:#1f513b;
    }
    .btnGhost:hover{transform:translateY(-1px)}
    .btnSmall{padding:12px 14px;font-size:16px;border-radius:16px;font-weight:700}

    .panel{
      background:linear-gradient(180deg,#f0faf4,#ffffff);
      border:1px solid #dcefe3;
      border-radius:20px;
      padding:18px;
      margin-top:14px;
    }

    .kpi{
      display:flex;flex-wrap:wrap;gap:12px;align-items:center;
      font-size:18px;
    }
    .kpi strong{font-size:22px}
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:999px;
      border:1px solid #dcefe3;background:#ffffff;
      color:#1f513b;font-weight:700;font-size:14px;
    }

    .list{
      margin:12px 0 0;
      padding:0;
      list-style:none;
      display:grid;
      gap:10px;
    }
    .li{
      display:flex;gap:10px;align-items:flex-start;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid #eef3ef;
      background:#fff;
    }
    .li .dot{
      width:28px;height:28px;border-radius:12px;
      background:linear-gradient(145deg,#eaf7f0,#ffffff);
      border:1px solid #dcefe3;
      display:grid;place-items:center;
      flex:0 0 auto;
      font-size:16px;
    }
    .li b{display:block;margin-bottom:2px}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--line);margin:16px 0}

    /* Week accordion */
    details.day{
      border:1px solid #e7efe9;
      background:#fff;
      border-radius:18px;
      padding:10px 12px;
    }
    details.day + details.day{margin-top:10px}
    details.day summary{
      cursor:pointer;
      list-style:none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      font-weight:800;
      font-size:18px;
      padding:10px 10px;
    }
    details.day summary::-webkit-details-marker{display:none}
    .sumRight{color:#1f513b;font-weight:700;font-size:14px}
    .dayBody{padding:6px 10px 12px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .chip{
      background:var(--soft);
      border:1px solid #dcefe3;
      color:#1f513b;
      padding:8px 10px;
      border-radius:999px;
      font-weight:700;
      font-size:14px;
    }

    .toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform:translateX(-50%);
      background:#0f172a;
      color:#fff;
      padding:12px 14px;
      border-radius:14px;
      opacity:0;
      pointer-events:none;
      transition:.2s ease;
      font-weight:700;
      box-shadow:0 14px 28px rgba(0,0,0,.18);
    }
    .toast.show{opacity:1; transform:translateX(-50%) translateY(-2px)}
    .footerNote{margin-top:14px;color:#7b8794;font-size:13px}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="brand">
      <div class="logo">ü•ó</div>
      <div>
        <h1>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</h1>
        <div class="sub">–ú—è–≥–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è –∂–µ–Ω—â–∏–Ω, –ø—Ä–∞–∫—Ç–∏–∫—É—é—â–∏—Ö –π–æ–≥—É</div>
      </div>
    </div>

    <!-- CALC -->
    <section class="card" id="calcCard">
      <h2>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
      <p class="hint">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –∏ –ø–æ–ª—É—á–∏—Ç–µ —Å—É—Ç–æ—á–Ω—É—é –Ω–æ—Ä–º—É, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—ë–º–∞–º –ø–∏—â–∏ –∏ —É–¥–æ–±–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–µ–Ω—é.</p>

      <form id="calcForm">
        <div class="grid">
          <div>
            <label>–í–µ—Å (–∫–≥)</label>
            <div class="field">
              <div class="icon">‚öñÔ∏è</div>
              <div class="ctrl"><input id="weight" type="number" inputmode="numeric" min="30" max="250" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 68"></div>
            </div>
          </div>

          <div>
            <label>–†–æ—Å—Ç (—Å–º)</label>
            <div class="field">
              <div class="icon">üìè</div>
              <div class="ctrl"><input id="height" type="number" inputmode="numeric" min="120" max="210" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 170"></div>
            </div>
          </div>

          <div>
            <label>–í–æ–∑—Ä–∞—Å—Ç</label>
            <div class="field">
              <div class="icon">üéÇ</div>
              <div class="ctrl"><input id="age" type="number" inputmode="numeric" min="16" max="90" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 35"></div>
            </div>
          </div>

          <div>
            <label>–ü–æ–ª</label>
            <div class="field">
              <div class="icon">‚ôÄÔ∏è</div>
              <div class="ctrl">
                <select id="gender">
                  <option value="female" selected>–ñ–µ–Ω—Å–∫–∏–π</option>
                  <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                </select>
              </div>
            </div>
          </div>

          <div>
            <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
            <div class="field">
              <div class="icon">üèÉ‚Äç‚ôÄÔ∏è</div>
              <div class="ctrl">
                <select id="activity">
                  <option value="1.25">–ù–∏–∑–∫–∞—è (–æ—Ñ–∏—Å, –º–∏–Ω–∏–º—É–º –¥–≤–∏–∂–µ–Ω–∏—è)</option>
                  <option value="1.35" selected>–ô–æ–≥–∞ 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
                  <option value="1.55">–ô–æ–≥–∞ 3‚Äì4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
                  <option value="1.75">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
                </select>
              </div>
            </div>
          </div>

          <div>
            <label>–¶–µ–ª—å</label>
            <div class="field">
              <div class="icon">üéØ</div>
              <div class="ctrl">
                <select id="goal">
                  <option value="0.90">–ú—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</option>
                  <option value="1.00" selected>–ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</option>
                  <option value="1.05">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º—ã</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <button id="btnCalc" class="btn btnPrimary" type="button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
      </form>

      <div id="calcOut" class="panel" style="display:none">
        <div class="kpi">
          <span class="pill">üåø –º—è–≥–∫–∏–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä</span>
          <div><strong>–°—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞:</strong> <span id="dailyKcal">‚Äî</span> –∫–∫–∞–ª</div>
        </div>
        <div class="muted" style="margin-top:8px" id="macroLine">–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: ‚Äî</div>

        <div class="hr"></div>

        <div style="font-weight:900;font-size:20px;margin-bottom:8px">–ü—Ä–∏–º–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø—Ä–∏—ë–º–∞–º –ø–∏—â–∏:</div>
        <ul class="list" id="splitList"></ul>

        <div class="btnRow">
          <button class="btn btnGhost btnSmall" type="button" id="btnDay">–ü–æ–∫–∞–∑–∞—Ç—å 1 –¥–µ–Ω—å</button>
          <button class="btn btnGhost btnSmall" type="button" id="btnWeek">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–µ–ª—é</button>
        </div>

        <div id="dayBox" class="panel" style="display:none;margin-top:14px"></div>

        <div id="weekBox" class="panel" style="display:none;margin-top:14px">
          <div style="font-weight:900;font-size:22px;margin-bottom:6px">–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</div>
          <div class="muted">–°—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ —Å–µ–±—è</div>
          <div class="hr"></div>

          <div id="weekDays"></div>

          <div class="hr"></div>
          <button class="btn btnGhost btnSmall" type="button" id="btnCopy">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é –¥–ª—è —Ç—Ä–µ–Ω–µ—Ä–∞</button>
          <div class="footerNote">–ö–æ–ø–∏—Ä—É–µ—Ç—Å—è –∫—Ä–∞—Ç–∫–æ –∏ –ø–æ–Ω—è—Ç–Ω–æ: —Å—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞ + —Å–ø–∏—Å–æ–∫ –¥–Ω–µ–π.</div>
        </div>
      </div>
    </section>

    <!-- SMART MENU -->
    <section class="card" id="smartCard">
      <h2>–£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
      <p class="hint">
        –ú–æ–∂–Ω–æ <b>–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</b> –ø—Ä–æ–¥—É–∫—Ç–æ–≤ ‚Äî –∏ –º—ã –∞–∫–∫—É—Ä–∞—Ç–Ω–æ –ø–æ–¥—Å—Ç–∞–≤–∏–º —Å–ø–∏—Å–æ–∫ (–∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è),
        –∏–ª–∏ <b>–≤–≤–µ—Å—Ç–∏ –ø—Ä–æ–¥—É–∫—Ç—ã –≤—Ä—É—á–Ω—É—é</b>.
      </p>

      <div class="grid">
        <div>
          <label>–§–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ / –ø—Ä–æ–¥—É–∫—Ç–æ–≤</label>
          <div class="field">
            <div class="icon">üì∑</div>
            <div class="ctrl"><input id="photo" type="file" accept="image/*"></div>
          </div>
          <div class="muted" style="margin-top:10px">
            –ù–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∏–∑ —Ñ–æ—Ç–æ¬ª ‚Äî –∏ —Å–ø–∏—Å–æ–∫ –ø–æ—è–≤–∏—Ç—Å—è –Ω–∏–∂–µ.
          </div>
        </div>

        <div>
          <label>–ü—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
          <div class="field" style="align-items:flex-start">
            <div class="icon" style="margin-top:4px">üß∫</div>
            <div class="ctrl"><textarea id="products" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, –æ–≤–æ—â–∏, –∫—É—Ä–∏—Ü–∞"></textarea></div>
          </div>
        </div>
      </div>

      <div class="btnRow">
        <button class="btn btnGhost btnSmall" type="button" id="btnFill">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –∏–∑ —Ñ–æ—Ç–æ</button>
        <button class="btn btnPrimary btnSmall" type="button" id="btnSmart">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é</button>
      </div>

      <div id="smartOut" class="panel" style="display:none"></div>
      <div class="footerNote">‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.</div>
    </section>
  </div>

  <div class="toast" id="toast">–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);

  const btnCalc = $("btnCalc");
  const calcOut = $("calcOut");
  const dailyKcal = $("dailyKcal");
  const macroLine = $("macroLine");
  const splitList = $("splitList");

  const btnDay = $("btnDay");
  const btnWeek = $("btnWeek");
  const dayBox = $("dayBox");
  const weekBox = $("weekBox");
  const weekDays = $("weekDays");
  const btnCopy = $("btnCopy");

  const btnFill = $("btnFill");
  const btnSmart = $("btnSmart");
  const photo = $("photo");
  const products = $("products");
  const smartOut = $("smartOut");

  const toast = $("toast");
  function showToast(text){
    toast.textContent = text || "–ì–æ—Ç–æ–≤–æ ‚úÖ";
    toast.classList.add("show");
    setTimeout(()=>toast.classList.remove("show"), 1400);
  }

  function round(n){ return Math.round(n); }

  function calcBMR(w,h,a,gender){
    // Mifflin‚ÄìSt Jeor
    if(gender==="male") return 10*w + 6.25*h - 5*a + 5;
    return 10*w + 6.25*h - 5*a - 161;
  }

  function buildSplit(cal){
    // –±–∞–∑–æ–≤–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: 30/35/15/20
    const split = [
      {name:"–ó–∞–≤—Ç—Ä–∞–∫", p:0.30, icon:"ü•£"},
      {name:"–û–±–µ–¥",    p:0.35, icon:"üç≤"},
      {name:"–ü–µ—Ä–µ–∫—É—Å", p:0.15, icon:"üçè"},
      {name:"–£–∂–∏–Ω",    p:0.20, icon:"ü•ó"},
    ];
    splitList.innerHTML = "";
    split.forEach(s=>{
      const kcal = round(cal*s.p);
      const li = document.createElement("li");
      li.className = "li";
      li.innerHTML = `
        <div class="dot">${s.icon}</div>
        <div>
          <b>${s.name}</b>
          <div class="muted">~${round(s.p*100)}% (${kcal} –∫–∫–∞–ª)</div>
        </div>
      `;
      splitList.appendChild(li);
    });
    return split.map(s=>({ ...s, kcal: round(cal*s.p) }));
  }

  function macrosFromCalories(cal, w){
    // –º—è–≥–∫–∏–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä: –±–µ–ª–æ–∫ 1.3–≥/–∫–≥, –∂–∏—Ä 0.9–≥/–∫–≥, –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É–≥–ª–µ–≤–æ–¥—ã
    const p = round(w * 1.3);
    const f = round(w * 0.9);
    const c = Math.max(0, round((cal - (p*4 + f*9)) / 4));
    return {p,f,c};
  }

  function buildDayMenu(split){
    const blocks = [
      {t:"–ó–∞–≤—Ç—Ä–∞–∫", icon:"ü•£", kcal: split[0].kcal, items:["–û–≤—Å—è–Ω–∫–∞ ‚Äî 60 –≥", "–¢–≤–æ—Ä–æ–≥/–π–æ–≥—É—Ä—Ç ‚Äî 150 –≥", "–Ø–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç—ã ‚Äî 1 –ø–æ—Ä—Ü–∏—è", "–û—Ä–µ—Ö–∏ ‚Äî 10 –≥"]},
      {t:"–û–±–µ–¥", icon:"üç≤", kcal: split[1].kcal, items:["–ë–µ–ª–æ–∫ (–∫—É—Ä–∏—Ü–∞/—Ä—ã–±–∞/–∏–Ω–¥–µ–π–∫–∞) ‚Äî 140‚Äì170 –≥", "–ö—Ä—É–ø–∞ (–≥—Ä–µ—á–∫–∞/—Ä–∏—Å) ‚Äî 60‚Äì70 –≥ —Å—É—Ö–æ–π", "–û–≤–æ—â–∏/—Å–∞–ª–∞—Ç ‚Äî 250‚Äì300 –≥", "–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ ‚Äî 1 —á.–ª."]},
      {t:"–ü–µ—Ä–µ–∫—É—Å", icon:"üçè", kcal: split[2].kcal, items:["–ô–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π ‚Äî 150‚Äì200 –≥", "–§—Ä—É–∫—Ç ‚Äî 1 —à—Ç.", "–û—Ä–µ—Ö–∏ ‚Äî 10 –≥ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)"]},
      {t:"–£–∂–∏–Ω", icon:"ü•ó", kcal: split[3].kcal, items:["–†—ã–±–∞/—è–π—Ü–∞/—Ç–≤–æ—Ä–æ–≥ ‚Äî 120‚Äì150 –≥", "–û–≤–æ—â–∏ ‚Äî 250‚Äì350 –≥", "–ú–∞—Å–ª–æ ‚Äî 1 —á.–ª. (–ø–æ –∂–µ–ª–∞–Ω–∏—é)"]},
    ];

    const html = `
      <div style="font-weight:900;font-size:22px;margin-bottom:6px">–ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
      <div class="muted">–°–æ–±—Ä–∞–Ω–æ –∫–∞–∫ ¬´–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä¬ª: –º–µ–Ω—è–µ–º –±–µ–ª–æ–∫/–≥–∞—Ä–Ω–∏—Ä/–æ–≤–æ—â–∏ ‚Äî –Ω–µ –ª–æ–º–∞—è —Å–∏—Å—Ç–µ–º—É.</div>
      <div class="hr"></div>
      ${blocks.map(b=>`
        <div class="li" style="margin:10px 0">
          <div class="dot">${b.icon}</div>
          <div style="flex:1">
            <b>${b.t} <span class="muted">‚âà ${b.kcal} –∫–∫–∞–ª</span></b>
            <div class="chips">
              ${b.items.map(x=>`<span class="chip">${x}</span>`).join("")}
            </div>
          </div>
        </div>
      `).join("")}
      <div class="hr"></div>
      <div class="muted"><b>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b> –µ—Å–ª–∏ –ø–æ—Å–ª–µ –π–æ–≥–∏ –≥–æ–ª–æ–¥–Ω–æ ‚Äî –¥–æ–±–∞–≤—å—Ç–µ +1 —Ñ—Ä—É–∫—Ç –∏–ª–∏ +1 –ø–æ—Ä—Ü–∏—é –æ–≤–æ—â–µ–π.</div>
    `;
    dayBox.innerHTML = html;
  }

  function buildWeekMenu(){
    const days = [
      {d:"–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", s:["–û–≤—Å—è–Ω–∫–∞","–ö—É—Ä–∏—Ü–∞","–û–≤–æ—â–∏","–ô–æ–≥—É—Ä—Ç"]},
      {d:"–í—Ç–æ—Ä–Ω–∏–∫",    s:["–Ø–π—Ü–∞","–†—ã–±–∞","–ö—Ä—É–ø–∞","–§—Ä—É–∫—Ç—ã"]},
      {d:"–°—Ä–µ–¥–∞",      s:["–¢–≤–æ—Ä–æ–≥","–ò–Ω–¥–µ–π–∫–∞","–û–≤–æ—â–∏"]},
      {d:"–ß–µ—Ç–≤–µ—Ä–≥",    s:["–û–º–ª–µ—Ç","–†—ã–±–∞","–°–∞–ª–∞—Ç"]},
      {d:"–ü—è—Ç–Ω–∏—Ü–∞",    s:["–ö–∞—à–∞","–ö—É—Ä–∏—Ü–∞","–û–≤–æ—â–∏"]},
      {d:"–°—É–±–±–æ—Ç–∞",    s:["–°–≤–æ–±–æ–¥–Ω—ã–π –¥–µ–Ω—å"]},
      {d:"–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ",s:["–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ–µ –ø–∏—Ç–∞–Ω–∏–µ"]},
    ];

    weekDays.innerHTML = "";
    days.forEach(x=>{
      const el = document.createElement("details");
      el.className = "day";
      el.innerHTML = `
        <summary>
          <span>${x.d}</span>
          <span class="sumRight">${x.s.join(" ‚Ä¢ ")}</span>
        </summary>
        <div class="dayBody">
          <div class="muted">–ò–¥–µ—è –¥–Ω—è:</div>
          <div class="chips">
            ${x.s.map(t=>`<span class="chip">${t}</span>`).join("")}
          </div>
        </div>
      `;
      weekDays.appendChild(el);
    });
  }

  function toClipboard(text){
    return navigator.clipboard.writeText(text);
  }

  function buildTrainerText(cal){
    const lines = [];
    lines.push(`–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é (–æ—Ä–∏–µ–Ω—Ç–∏—Ä): ~${cal} –∫–∫–∞–ª/–¥–µ–Ω—å`);
    lines.push(`–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: –∑–∞–≤—Ç—Ä–∞–∫ 30% ‚Ä¢ –æ–±–µ–¥ 35% ‚Ä¢ –ø–µ—Ä–µ–∫—É—Å 15% ‚Ä¢ —É–∂–∏–Ω 20%`);
    lines.push("");
    const daySummaries = Array.from(weekDays.querySelectorAll("details.day summary"))
      .map(s=>s.textContent.trim().replace(/\s+/g," "));
    daySummaries.forEach(x=>lines.push("‚Äî " + x));
    return lines.join("\n");
  }

  function safeNumber(v){
    const n = Number(v);
    return Number.isFinite(n) ? n : 0;
  }

  function doCalc(){
    const w = safeNumber($("weight").value);
    const h = safeNumber($("height").value);
    const a = safeNumber($("age").value);
    const gender = $("gender").value;
    const act = safeNumber($("activity").value);
    const goal = safeNumber($("goal").value);

    if(!w || !h || !a){
      alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç.");
      return;
    }

    const bmr = calcBMR(w,h,a,gender);
    const cal = Math.max(1200, round(bmr * act * goal));

    const m = macrosFromCalories(cal, w);
    dailyKcal.textContent = cal;
    macroLine.textContent = `–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: –±–µ–ª–∫–∏ ${m.p} –≥ ‚Ä¢ –∂–∏—Ä—ã ${m.f} –≥ ‚Ä¢ —É–≥–ª–µ–≤–æ–¥—ã ${m.c} –≥`;

    const split = buildSplit(cal);
    buildDayMenu(split);
    buildWeekMenu();

    calcOut.style.display = "block";
    dayBox.style.display = "none";
    weekBox.style.display = "none";
    showToast("–†–∞—Å—á—ë—Ç –≥–æ—Ç–æ–≤ ‚úÖ");
  }

  function toggle(el){
    el.style.display = (el.style.display === "none" || !el.style.display) ? "block" : "none";
  }

  // Smart menu
  const mockSets = [
    ["—è–π—Ü–∞","—Ç–≤–æ—Ä–æ–≥","–æ–≤–æ—â–∏","–π–æ–≥—É—Ä—Ç","–∫—É—Ä–∏—Ü–∞"],
    ["—Ä—ã–±–∞","–≥—Ä–µ—á–∫–∞","–æ–≤–æ—â–∏","—è–±–ª–æ–∫–∏","–æ—Ä–µ—Ö–∏"],
    ["–æ–≤—Å—è–Ω–∫–∞","–∫–µ—Ñ–∏—Ä","—è–≥–æ–¥—ã","—Å—ã—Ä","–∑–µ–ª–µ–Ω—å"],
    ["–∏–Ω–¥–µ–π–∫–∞","—Ä–∏—Å","—Å–∞–ª–∞—Ç","–±–∞–Ω–∞–Ω","—Ç–≤–æ—Ä–æ–≥"],
  ];

  function fillFromPhoto(){
    if(!photo.files || !photo.files[0]){
      alert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ.");
      return;
    }
    const pick = mockSets[Math.floor(Math.random()*mockSets.length)];
    products.value = pick.join(", ");
    showToast("–°–ø–∏—Å–æ–∫ –∑–∞–ø–æ–ª–Ω–µ–Ω –∏–∑ —Ñ–æ—Ç–æ ‚úÖ");
  }

  function makeSmartMenu(){
    const list = products.value.trim();
    if(!list){
      alert("–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é) –∏–ª–∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–∑ —Ñ–æ—Ç–æ.");
      return;
    }
    const items = list.split(",").map(x=>x.trim()).filter(Boolean);
    const nice = items.slice(0, 10);

    smartOut.style.display = "block";
    smartOut.innerHTML = `
      <div style="font-weight:900;font-size:22px;margin-bottom:6px">–ú–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å</div>
      <div class="muted">–°–æ–±—Ä–∞–Ω–æ –∫–∞–∫ –±—ã—Å—Ç—Ä—ã–π —à–∞–±–ª–æ–Ω –Ω–∞ –¥–µ–Ω—å. –ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∏ –º–µ–Ω—è—Ç—å –±–µ–ª–æ–∫/–≥–∞—Ä–Ω–∏—Ä/–æ–≤–æ—â–∏.</div>
      <div class="hr"></div>

      <div class="li">
        <div class="dot">ü•£</div>
        <div><b>–ó–∞–≤—Ç—Ä–∞–∫</b><div class="muted">–û—Å–Ω–æ–≤–∞ + –¥–æ–±–∞–≤–∫–∞ –∏–∑: ${nice.join(", ")}</div></div>
      </div>
      <div class="li">
        <div class="dot">üç≤</div>
        <div><b>–û–±–µ–¥</b><div class="muted">–¢—ë–ø–ª–∞—è —Ç–∞—Ä–µ–ª–∫–∞ –∏–∑: ${nice.join(", ")}</div></div>
      </div>
      <div class="li">
        <div class="dot">üçè</div>
        <div><b>–ü–µ—Ä–µ–∫—É—Å</b><div class="muted">–õ—ë–≥–∫–∏–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–∑: ${nice.join(", ")}</div></div>
      </div>
      <div class="li">
        <div class="dot">ü•ó</div>
        <div><b>–£–∂–∏–Ω</b><div class="muted">–ú—è–≥–∫–∏–π –ø—Ä–∏—ë–º –ø–∏—â–∏ –∏–∑: ${nice.join(", ")}</div></div>
      </div>

      <div class="hr"></div>
      <div class="muted"><b>–ü–æ–¥—Å–∫–∞–∑–∫–∞:</b> –µ—Å–ª–∏ —É—Å—Ç–∞–ª–æ—Å—Ç—å –≤—ã—Å–æ–∫–∞—è ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –æ–≤–æ—â–µ–π –∏ –Ω–æ—Ä–º—É –±–µ–ª–∫–∞ –≤ –æ–±–µ–¥.</div>
    `;
    showToast("–ú–µ–Ω—é —Å–æ–±—Ä–∞–Ω–æ ‚úÖ");
  }

  // Bind
  btnCalc.addEventListener("click", doCalc);
  btnDay.addEventListener("click", ()=>toggle(dayBox));
  btnWeek.addEventListener("click", ()=>toggle(weekBox));

  btnCopy.addEventListener("click", async ()=>{
    const cal = dailyKcal.textContent || "‚Äî";
    const text = buildTrainerText(cal);
    try{
      await toClipboard(text);
      showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚úÖ");
    }catch(e){
      alert("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä.");
    }
  });

  btnFill.addEventListener("click", fillFromPhoto);
  btnSmart.addEventListener("click", makeSmartMenu);

  // prevent form submit by Enter
  $("calcForm").addEventListener("submit", (e)=>e.preventDefault());
})();
</script>
</body>
</html>
