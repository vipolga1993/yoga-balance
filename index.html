<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ ‚Äî —ç–Ω–µ—Ä–≥–∏—è –∏ –π–æ–≥–∞</title>

<style>
  :root{
    --bg:#f6faf7;
    --card:#ffffff;
    --text:#1f2937;
    --muted:#6b7280;
    --green:#6fbf8a;
    --green-dark:#2f6f4e;
    --green-soft:#e9f6ee;
    --border:#e6efe9;
    --radius:18px;
    --shadow:0 12px 28px rgba(0,0,0,.06);
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(900px 520px at 15% 0%, #eaf8f0 0%, transparent 60%),
      radial-gradient(900px 520px at 95% 10%, #eef5ff 0%, transparent 58%),
      var(--bg);
    color:var(--text);
  }
  .wrap{max-width:1100px;margin:auto;padding:24px 16px 60px}

  /* Header */
  .header{display:flex;gap:14px;align-items:flex-start}
  .logo{
    width:48px;height:48px;border-radius:16px;
    background:var(--green-soft);
    display:grid;place-items:center;font-size:22px;
    box-shadow:var(--shadow);
    border:1px solid rgba(0,0,0,.03);
    flex:0 0 auto;
  }
  h1{margin:0;font-size:34px;color:var(--green-dark);letter-spacing:-.3px}
  .subtitle{margin:8px 0 0;color:var(--muted);max-width:820px;line-height:1.55}

  /* Layout */
  .grid{
    display:grid;
    grid-template-columns:1.1fr .9fr;
    gap:18px;
    margin-top:20px;
  }
  @media(max-width:900px){ .grid{grid-template-columns:1fr} }

  /* Card */
  .card{
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;
    box-shadow:var(--shadow);
    border:1px solid var(--border);
  }
  .card h2{margin:0 0 10px;font-size:22px;letter-spacing:-.2px}
  .hint{color:var(--muted);font-size:14px;line-height:1.55;margin:0}

  /* Form */
  .form{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:14px;
    margin-top:14px;
  }
  @media(max-width:700px){ .form{grid-template-columns:1fr} }

  label{display:block;font-size:13px;color:var(--muted);margin:0 0 6px}
  .field{position:relative}
  .field .ico{
    position:absolute;left:12px;top:50%;
    transform:translateY(-50%);
    font-size:18px;opacity:.65;
    pointer-events:none;
  }
  .field input,.field select{
    width:100%;
    padding:12px 12px 12px 42px;
    border-radius:14px;
    border:1px solid #ddd;
    background:#fbfbfb;
    font-size:16px;
    outline:none;
  }
  .field input:focus,.field select:focus{
    border-color:#bfe8cf;
    box-shadow:0 0 0 4px rgba(111,191,138,.16);
    background:#fff;
  }

  /* Buttons */
  .btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:16px;
    background:var(--green);
    color:#fff;
    font-size:16px;
    font-weight:800;
    cursor:pointer;
    margin-top:14px;
  }
  .btn.secondary{
    background:var(--green-soft);
    color:var(--green-dark);
    border:1px solid var(--border);
  }
  .btn.copy{
    background:#fff;
    color:var(--green-dark);
    border:1px dashed var(--border);
  }
  .btn:active{transform:translateY(1px)}

  .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btnRow .btn{width:auto;margin-top:0;padding:12px 14px;border-radius:999px;font-size:15px}

  /* Alerts */
  .alert{
    display:none;
    margin-top:12px;
    padding:12px;
    border-radius:14px;
    background:#fff7ed;
    border:1px solid #fed7aa;
    color:#9a3412;
    font-size:14px;
    line-height:1.5;
  }

  /* Result */
  .result{display:none;margin-top:16px}
  .kcalLine{
    font-size:14px;color:var(--muted);margin:0 0 8px;line-height:1.5
  }
  .kcal{
    font-size:30px;font-weight:900;color:var(--green-dark);
  }

  .meals{
    margin-top:12px;
    display:grid;
    gap:10px;
  }
  .meal{
    background:#fff;
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
  }
  .meal b{display:block;margin-bottom:4px}

  /* Tabs */
  .tabs{display:flex;gap:10px;margin-top:16px;flex-wrap:wrap}
  .tab{
    border:1px solid var(--border);
    padding:10px 14px;
    border-radius:999px;
    background:#fff;
    cursor:pointer;
    font-weight:800;
  }
  .tab.active{
    background:var(--green-soft);
    color:var(--green-dark);
    border-color:#bfe8cf;
  }

  .menuBox{display:none;margin-top:14px}

  /* Day menu cards */
  .menuCard{
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
    background:#fff;
    margin-bottom:10px;
  }
  .menuCard h3{
    margin:0 0 6px;
    font-size:16px;
    letter-spacing:-.2px;
  }
  .menuCard p{
    margin:0 0 10px;
    color:var(--muted);
    font-size:13px;
    line-height:1.45;
  }
  .menuCard ul{
    margin:0;
    padding-left:18px;
    display:grid;
    gap:8px;
    line-height:1.45;
  }

  /* Week collapsible */
  details.day{
    border:1px solid var(--border);
    border-radius:14px;
    background:#fff;
    margin-bottom:10px;
    overflow:hidden;
  }
  details.day summary{
    cursor:pointer;
    list-style:none;
    padding:12px;
    font-weight:900;
    background:#f7fbf8;
  }
  details.day summary::-webkit-details-marker{display:none}
  .dayContent{padding:12px}
  .dayContent ul{margin:0;padding-left:18px;display:grid;gap:8px;line-height:1.45}
  .small{margin-top:8px;color:var(--muted);font-size:13px;line-height:1.45}

  /* Smart menu */
  textarea{
    width:100%;
    padding:12px;
    border-radius:14px;
    border:1px solid #ddd;
    min-height:92px;
    background:#fbfbfb;
    font-size:15px;
    outline:none;
  }
  textarea:focus{
    border-color:#bfe8cf;
    box-shadow:0 0 0 4px rgba(111,191,138,.16);
    background:#fff;
  }
  .smartOut{display:none;margin-top:14px}

  .footer{
    margin-top:14px;
    font-size:12px;
    color:var(--muted);
    line-height:1.55;
  }
</style>
</head>

<body>
<div class="wrap">

  <div class="header">
    <div class="logo">ü•ó</div>
    <div>
      <h1>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</h1>
      <p class="subtitle">
        –ú—è–≥–∫–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∂–µ–Ω—â–∏–Ω, –ø—Ä–∞–∫—Ç–∏–∫—É—é—â–∏—Ö –π–æ–≥—É –∏ –≤—ã–±–∏—Ä–∞—é—â–∏—Ö –±–µ—Ä–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ–ª—É.
        –ë–µ–∑ –¥–∏–µ—Ç, –∑–∞–ø—Ä–µ—Ç–æ–≤ –∏ –¥–∞–≤–ª–µ–Ω–∏—è ‚Äî —Å –æ–ø–æ—Ä–æ–π –Ω–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –∏ —Ä–µ–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å.
      </p>
    </div>
  </div>

  <div class="grid">
    <!-- LEFT -->
    <div class="card">
      <h2>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
      <p class="hint">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –ø–æ–ª—É—á–∏—Ç–µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä –ø–æ —Å—É—Ç–æ—á–Ω–æ–π –Ω–æ—Ä–º–µ –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–µ –º–µ–Ω—é –Ω–∞ –¥–µ–Ω—å/–Ω–µ–¥–µ–ª—é.</p>

      <div class="form">
        <div>
          <label for="weight">–í–µ—Å (–∫–≥)</label>
          <div class="field"><span class="ico">‚öñÔ∏è</span><input id="weight" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 72"></div>
        </div>
        <div>
          <label for="height">–†–æ—Å—Ç (—Å–º)</label>
          <div class="field"><span class="ico">üìè</span><input id="height" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 168"></div>
        </div>
        <div>
          <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
          <div class="field"><span class="ico">üéÇ</span><input id="age" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 36"></div>
        </div>
        <div>
          <label for="gender">–ü–æ–ª</label>
          <div class="field">
            <span class="ico">üë§</span>
            <select id="gender">
              <option value="female" selected>–ñ–µ–Ω—Å–∫–∏–π</option>
              <option value="male">–ú—É–∂—Å–∫–æ–π</option>
            </select>
          </div>
        </div>
        <div>
          <label for="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</label>
          <div class="field">
            <span class="ico">üßò‚Äç‚ôÄÔ∏è</span>
            <select id="activity">
              <option value="1.2">–ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –æ—Ñ–∏—Å, –¥–æ—Ä–æ–≥–∞, –º–∞–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è</option>
              <option value="1.35">–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –ø—Ä–æ–≥—É–ª–∫–∏ –∏ –±—ã—Ç–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</option>
              <option value="1.45">–ô–æ–≥–∞ 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é ‚Äî –º—è–≥–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
              <option value="1.55">–ô–æ–≥–∞ 2‚Äì3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
              <option value="1.7">–ô–æ–≥–∞ 3+ —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é / –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∏—Ç–º</option>
            </select>
          </div>
        </div>
        <div>
          <label for="goal">–¶–µ–ª—å</label>
          <div class="field">
            <span class="ico">üéØ</span>
            <select id="goal">
              <option value="0.90" selected>–ú—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</option>
              <option value="1.00">–ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</option>
              <option value="1.05">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º—ã</option>
            </select>
          </div>
        </div>
      </div>

      <button class="btn" id="calcBtn" type="button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
      <div class="alert" id="calcAlert">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç (—á–∏—Å–ª–∞–º–∏), –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª –µ—â—ë —Ä–∞–∑.</div>

      <div class="result" id="result">
        <p class="kcalLine">–í–∞—à–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è —Å—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞ —ç–Ω–µ—Ä–≥–∏–∏:</p>
        <div class="kcal">‚âà <span id="calVal">‚Äî</span> –∫–∫–∞–ª/–¥–µ–Ω—å</div>
        <div class="kcalLine" id="macroLine">–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: ‚Äî</div>

        <div class="meals" id="meals"></div>

        <div class="tabs">
          <button class="tab active" id="tabDay" type="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä –Ω–∞ –¥–µ–Ω—å</button>
          <button class="tab" id="tabWeek" type="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</button>
        </div>

        <div class="menuBox" id="dayMenu"></div>
        <div class="menuBox" id="weekMenu"></div>

        <button class="btn copy" id="copyBtn" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é</button>
      </div>
    </div>

    <!-- RIGHT -->
    <div class="card">
      <h2>–£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
      <p class="hint">
        –Ø –ø–æ–º–æ–≥—É —Å–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å —É –≤–∞—Å –¥–æ–º–∞.
        –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ <b>–∏–ª–∏</b> –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –≤—Ä—É—á–Ω—É—é ‚Äî –∫–∞–∫ –≤–∞–º —É–¥–æ–±–Ω–µ–µ ü§ç
      </p>

      <label for="photo">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</label>
      <input id="photo" type="file" accept="image/*">

      <div class="btnRow">
        <button class="btn secondary" id="fillFromPhotoBtn" type="button">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ</button>
      </div>

      <div style="height:10px"></div>

      <label for="products">–ü—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
      <textarea id="products" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, –æ–≤–æ—â–∏, –∫—É—Ä–∏—Ü–∞"></textarea>

      <button class="btn secondary" id="smartBtn" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é</button>
      <div class="alert" id="smartAlert">–î–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª).</div>

      <div class="smartOut" id="smartOut"></div>

      <div class="footer">
        –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø–∏—Ç–∞–Ω–∏–∏ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.
      </div>
    </div>
  </div>

</div>

<script>
(function(){
  const $ = (id) => document.getElementById(id);

  // Elements
  const weightEl = $("weight");
  const heightEl = $("height");
  const ageEl    = $("age");
  const genderEl = $("gender");
  const activityEl = $("activity");
  const goalEl = $("goal");

  const calcBtn = $("calcBtn");
  const calcAlert = $("calcAlert");

  const resultEl = $("result");
  const calValEl = $("calVal");
  const macroLineEl = $("macroLine");
  const mealsEl = $("meals");

  const tabDay = $("tabDay");
  const tabWeek = $("tabWeek");
  const dayMenu = $("dayMenu");
  const weekMenu = $("weekMenu");
  const copyBtn = $("copyBtn");

  const photoEl = $("photo");
  const fillFromPhotoBtn = $("fillFromPhotoBtn");
  const productsEl = $("products");
  const smartBtn = $("smartBtn");
  const smartAlert = $("smartAlert");
  const smartOut = $("smartOut");

  // State
  let currentView = "day"; // day/week
  let lastCalculated = null; // {cal, split, dayText, weekText}
  let recognizedText = "";

  function parseNum(val){
    const s = String(val ?? "").replace(",", ".").trim();
    const n = Number(s);
    return Number.isFinite(n) ? n : NaN;
  }
  function round(n){ return Math.round(n); }
  function clamp(n,a,b){ return Math.max(a, Math.min(b,n)); }

  function mifflinStJeor(w,h,a,gender){
    return (gender === "male")
      ? (10*w + 6.25*h - 5*a + 5)
      : (10*w + 6.25*h - 5*a - 161);
  }

  function kcalSplit(total){
    const b = round(total * 0.30);
    const l = round(total * 0.35);
    const s = round(total * 0.15);
    const d = total - b - l - s;
    return { b, l, s, d };
  }

  function setActiveTab(which){
    currentView = which;
    tabDay.classList.toggle("active", which === "day");
    tabWeek.classList.toggle("active", which === "week");
    dayMenu.style.display = (which === "day") ? "block" : "none";
    weekMenu.style.display = (which === "week") ? "block" : "none";
  }

  function renderMeals(split){
    mealsEl.innerHTML = `
      <div class="meal"><b>ü´ê –ó–∞–≤—Ç—Ä–∞–∫</b>${split.b} –∫–∫–∞–ª</div>
      <div class="meal"><b>üç≤ –û–±–µ–¥</b>${split.l} –∫–∫–∞–ª</div>
      <div class="meal"><b>üçè –ü–µ—Ä–µ–∫—É—Å</b>${split.s} –∫–∫–∞–ª</div>
      <div class="meal"><b>ü•ó –£–∂–∏–Ω</b>${split.d} –∫–∫–∞–ª</div>
    `;
  }

  function renderDayMenu(split){
    dayMenu.innerHTML = `
      <div class="menuCard">
        <h3>–ü—Ä–∏–º–µ—Ä –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å</h3>
        <p>–ì–∏–±–∫–∏–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä: –≤—ã –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É ¬´–±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + —É–º–µ—Ä–µ–Ω–Ω–æ –≥–∞—Ä–Ω–∏—Ä¬ª.</p>
      </div>

      <div class="menuCard">
        <h3>ü´ê –ó–∞–≤—Ç—Ä–∞–∫ ‚âà ${split.b} –∫–∫–∞–ª</h3>
        <p>–¢—ë–ø–ª—ã–π –∏ —Å—ã—Ç–Ω—ã–π ‚Äî —á—Ç–æ–±—ã –Ω–µ —Ç—è–Ω—É—Ç—å—Å—è –∫ —Å–ª–∞–¥–∫–æ–º—É —á–µ—Ä–µ–∑ —á–∞—Å.</p>
        <ul>
          <li>–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è (—Å—É—Ö–∏–µ) ‚Äî 60 –≥</li>
          <li>–Ø–≥–æ–¥—ã ‚Äî 100 –≥</li>
          <li>–Ø–π—Ü–æ ‚Äî 1‚Äì2 —à—Ç (–ø–æ –≥–æ–ª–æ–¥—É)</li>
          <li>–û—Ä–µ—Ö–∏ ‚Äî 10 –≥ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)</li>
        </ul>
      </div>

      <div class="menuCard">
        <h3>üç≤ –û–±–µ–¥ ‚âà ${split.l} –∫–∫–∞–ª</h3>
        <p>–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—ë–º –ø–∏—â–∏ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.</p>
        <ul>
          <li>–ö—É—Ä–∏—Ü–∞/—Ä—ã–±–∞ ‚Äî 140‚Äì170 –≥</li>
          <li>–ì—Ä–µ—á–∫–∞/—Ä–∏—Å (—Å—É—Ö–∏–µ) ‚Äî 60‚Äì70 –≥</li>
          <li>–û–≤–æ—â–∏/—Å–∞–ª–∞—Ç ‚Äî 250‚Äì300 –≥</li>
          <li>–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ ‚Äî 1 —á.–ª.</li>
        </ul>
      </div>

      <div class="menuCard">
        <h3>üçè –ü–µ—Ä–µ–∫—É—Å ‚âà ${split.s} –∫–∫–∞–ª</h3>
        <p>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –∏ —á—É–≤—Å—Ç–≤–∞ –≥–æ–ª–æ–¥–∞.</p>
        <ul>
          <li>–¢–≤–æ—Ä–æ–≥ 5% ‚Äî 180‚Äì220 –≥</li>
          <li>–§—Ä—É–∫—Ç ‚Äî 1 —à—Ç</li>
          <li>–í–æ–¥–∞ ‚Äî 1 —Å—Ç–∞–∫–∞–Ω</li>
        </ul>
      </div>

      <div class="menuCard">
        <h3>ü•ó –£–∂–∏–Ω ‚âà ${split.d} –∫–∫–∞–ª</h3>
        <p>–õ—ë–≥–∫–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.</p>
        <ul>
          <li>–û–≤–æ—â–∏ ‚Äî 300‚Äì400 –≥</li>
          <li>–ë–µ–ª–æ–∫ (—è–π—Ü–∞/—Ä—ã–±–∞/—Ç–≤–æ—Ä–æ–≥) ‚Äî 1 –≤–∞—Ä–∏–∞–Ω—Ç</li>
          <li>–ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è ‚Äî –≥–∞—Ä–Ω–∏—Ä –º–∞–ª–µ–Ω—å–∫–æ–π –ø–æ—Ä—Ü–∏–µ–π</li>
        </ul>
        <div class="small">‚ú® –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤–æ–¥—ã –∏ –æ–≤–æ—â–µ–π, –∞ —É–∂–∏–Ω —Å–¥–µ–ª–∞–π—Ç–µ –ª–µ–≥—á–µ.</div>
      </div>
    `;
  }

  function renderWeekMenu(total, split){
    const breakfast = [
      "–û–≤—Å—è–Ω–∫–∞ 60 –≥ + —è–≥–æ–¥—ã 100 –≥ + —è–π—Ü–æ 1‚Äì2 —à—Ç",
      "–¢–≤–æ—Ä–æ–≥ 200 –≥ + —Ñ—Ä—É–∫—Ç 1 —à—Ç + –æ—Ä–µ—Ö–∏ 10 –≥",
      "–û–º–ª–µ—Ç 2 —è–π—Ü–∞ + –æ–≤–æ—â–∏ 250 –≥",
      "–ô–æ–≥—É—Ä—Ç 250 –≥ + —Ñ—Ä—É–∫—Ç—ã + –Ω–µ–º–Ω–æ–≥–æ –æ—Ä–µ—Ö–æ–≤"
    ];
    const lunch = [
      "–ö—É—Ä–∏—Ü–∞ 150 –≥ + –≥—Ä–µ—á–∫–∞ 60‚Äì70 –≥ (—Å—É—Ö–∞—è) + —Å–∞–ª–∞—Ç 300 –≥",
      "–†—ã–±–∞ 170 –≥ + —Ä–∏—Å 60 –≥ (—Å—É—Ö–∞—è) + –æ–≤–æ—â–∏ 300 –≥",
      "–ò–Ω–¥–µ–π–∫–∞ 150 –≥ + –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å 250 –≥ + –æ–≤–æ—â–∏ 250 –≥",
      "–ß–µ—á–µ–≤–∏—Ü–∞/—Ñ–∞—Å–æ–ª—å 200 –≥ + –æ–≤–æ—â–∏ 300 –≥ + –º–∞—Å–ª–æ 1 —á.–ª."
    ];
    const snack = [
      "–¢–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ + —Ñ—Ä—É–∫—Ç",
      "–ô–æ–≥—É—Ä—Ç 200‚Äì250 –≥ + —è–≥–æ–¥—ã",
      "–§—Ä—É–∫—Ç + –æ—Ä–µ—Ö–∏ 15 –≥",
      "–ö–µ—Ñ–∏—Ä/—Ä—è–∂–µ–Ω–∫–∞ 250 –º–ª"
    ];
    const dinner = [
      "–û–≤–æ—â–∏ 350 –≥ + —Ä—ã–±–∞ 140 –≥",
      "–û–≤–æ—â–∏ 350 –≥ + —è–π—Ü–∞ 2 —à—Ç",
      "–û–≤–æ—â–∏ 350 –≥ + —Ç–≤–æ—Ä–æ–≥ 150 –≥",
      "–û–≤–æ—â–∏ 350 –≥ + –∫—É—Ä–∏—Ü–∞ 120‚Äì140 –≥"
    ];
    const days = [
      { name:"–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", vibe:"–±–∞–ª–∞–Ω—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π" },
      { name:"–í—Ç–æ—Ä–Ω–∏–∫", vibe:"–ª—ë–≥–∫–æ—Å—Ç—å" },
      { name:"–°—Ä–µ–¥–∞", vibe:"—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è" },
      { name:"–ß–µ—Ç–≤–µ—Ä–≥", vibe:"–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ" },
      { name:"–ü—è—Ç–Ω–∏—Ü–∞", vibe:"—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å" },
      { name:"–°—É–±–±–æ—Ç–∞", vibe:"–≥–∏–±–∫–æ—Å—Ç—å" },
      { name:"–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", vibe:"–º—è–≥–∫–∏–π –¥–µ–Ω—å" }
    ];
    const pick = (arr,i) => arr[i % arr.length];

    weekMenu.innerHTML = `
      <div class="menuCard">
        <h3>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</h3>
        <p>–°—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å: ‚âà ${total} –∫–∫–∞–ª. –ú–µ–Ω—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî —Ç–∞–∫ –ª–µ–≥—á–µ –¥–µ—Ä–∂–∞—Ç—å –±–∞–ª–∞–Ω—Å.</p>
        <div class="small">–ö–∞–ª–æ—Ä–∏–∏ –ø–æ –ø—Ä–∏—ë–º–∞–º: –∑–∞–≤—Ç—Ä–∞–∫ ~${split.b}, –æ–±–µ–¥ ~${split.l}, –ø–µ—Ä–µ–∫—É—Å ~${split.s}, —É–∂–∏–Ω ~${split.d} –∫–∫–∞–ª.</div>
      </div>
      ${days.map((d,i)=>`
        <details class="day" ${i===0 ? "open" : ""}>
          <summary>${d.name} ‚Äî ${d.vibe}</summary>
          <div class="dayContent">
            <ul>
              <li><b>ü´ê –ó–∞–≤—Ç—Ä–∞–∫ (~${split.b} –∫–∫–∞–ª):</b> ${pick(breakfast,i)}</li>
              <li><b>üç≤ –û–±–µ–¥ (~${split.l} –∫–∫–∞–ª):</b> ${pick(lunch,i)}</li>
              <li><b>üçè –ü–µ—Ä–µ–∫—É—Å (~${split.s} –∫–∫–∞–ª):</b> ${pick(snack,i)}</li>
              <li><b>ü•ó –£–∂–∏–Ω (~${split.d} –∫–∫–∞–ª):</b> ${pick(dinner,i)}</li>
            </ul>
            <div class="small">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ–≤–æ—â–∏ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–∏—ë–º–µ –ø–æ–º–æ–≥–∞—é—Ç –¥–µ—Ä–∂–∞—Ç—å —Å—ã—Ç–æ—Å—Ç—å –º—è–≥–∫–æ –∏ –±–µ–∑ —Å—Ä—ã–≤–æ–≤.</div>
          </div>
        </details>
      `).join("")}
      <div class="menuCard">
        <div class="small">‚ú® –≠—Ç—É –Ω–µ–¥–µ–ª—é –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å 3‚Äì4 —Ä–∞–∑–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç—Å—è –º–µ—Å—è—Ü –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞.</div>
      </div>
    `;
  }

  function buildCopyText(){
    if(!lastCalculated) return "";
    return (currentView === "week") ? lastCalculated.weekText : lastCalculated.dayText;
  }

  function toPlainTextDay(total, split){
    return [
      `–ú–µ–Ω—é –Ω–∞ –¥–µ–Ω—å (—Å—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å: ~${total} –∫–∫–∞–ª)`,
      ``,
      `–ó–∞–≤—Ç—Ä–∞–∫ (~${split.b} –∫–∫–∞–ª): –æ–≤—Å—è–Ω–∫–∞ 60 –≥ (—Å—É—Ö–∞—è) + —è–≥–æ–¥—ã 100 –≥ + —è–π—Ü–æ 1‚Äì2 —à—Ç + –æ—Ä–µ—Ö–∏ 10 –≥ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)`,
      `–û–±–µ–¥ (~${split.l} –∫–∫–∞–ª): –∫—É—Ä–∏—Ü–∞/—Ä—ã–±–∞ 140‚Äì170 –≥ + –≥—Ä–µ—á–∫–∞/—Ä–∏—Å 60‚Äì70 –≥ (—Å—É—Ö–∞—è) + –æ–≤–æ—â–∏ 250‚Äì300 –≥ + –º–∞—Å–ª–æ 1 —á.–ª.`,
      `–ü–µ—Ä–µ–∫—É—Å (~${split.s} –∫–∫–∞–ª): —Ç–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ + —Ñ—Ä—É–∫—Ç 1 —à—Ç + –≤–æ–¥–∞`,
      `–£–∂–∏–Ω (~${split.d} –∫–∫–∞–ª): –æ–≤–æ—â–∏ 300‚Äì400 –≥ + –±–µ–ª–æ–∫ (—è–π—Ü–∞/—Ä—ã–±–∞/—Ç–≤–æ—Ä–æ–≥) + (–ø–æ –∂–µ–ª–∞–Ω–∏—é) –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ—Ä—Ü–∏—è –≥–∞—Ä–Ω–∏—Ä–∞`,
      ``,
      `–ü–æ–¥—Å–∫–∞–∑–∫–∞: –µ—Å–ª–∏ —É—Å—Ç–∞–ª–æ—Å—Ç—å ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤–æ–¥—ã –∏ –æ–≤–æ—â–µ–π, –∞ —É–∂–∏–Ω —Å–¥–µ–ª–∞–π—Ç–µ –ª–µ–≥—á–µ.`
    ].join("\n");
  }

  function toPlainTextWeek(total, split){
    return [
      `–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é (—Å—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å: ~${total} –∫–∫–∞–ª)`,
      `–ö–∞–ª–æ—Ä–∏–∏ –ø–æ –ø—Ä–∏—ë–º–∞–º: –∑–∞–≤—Ç—Ä–∞–∫ ~${split.b}, –æ–±–µ–¥ ~${split.l}, –ø–µ—Ä–µ–∫—É—Å ~${split.s}, —É–∂–∏–Ω ~${split.d} –∫–∫–∞–ª.`,
      ``,
      `–ü–Ω: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–í—Ç: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–°—Ä: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–ß—Ç: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–ü—Ç: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–°–±: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      `–í—Å: –ó–∞–≤—Ç—Ä–∞–∫/–û–±–µ–¥/–ü–µ—Ä–µ–∫—É—Å/–£–∂–∏–Ω ‚Äî –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –¥–Ω—è`,
      ``,
      `–ü–æ–¥—Å–∫–∞–∑–∫–∞: –º–µ–Ω—è–π—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É ¬´–±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + —É–º–µ—Ä–µ–Ω–Ω–æ –≥–∞—Ä–Ω–∏—Ä¬ª.`
    ].join("\n");
  }

  async function copyToClipboard(text){
    // Clipboard API + fallback
    try{
      await navigator.clipboard.writeText(text);
      return true;
    } catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      ta.style.position = "fixed";
      ta.style.opacity = "0";
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      try{
        const ok = document.execCommand("copy");
        document.body.removeChild(ta);
        return ok;
      } catch(err){
        document.body.removeChild(ta);
        return false;
      }
    }
  }

  function simulatePhotoToText(file){
    const sets = [
      "—è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, –æ–≤–æ—â–∏, —è–±–ª–æ–∫–∏",
      "–∫—É—Ä–∏—Ü–∞, —Ä–∏—Å, –æ–≤–æ—â–∏, –π–æ–≥—É—Ä—Ç, –±–∞–Ω–∞–Ω—ã",
      "—Ä—ã–±–∞, –≥—Ä–µ—á–∫–∞, –æ–≤–æ—â–∏, —Ç–≤–æ—Ä–æ–≥, —è–≥–æ–¥—ã",
      "–∏–Ω–¥–µ–π–∫–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –æ–≤–æ—â–∏, —è–π—Ü–∞, —è–±–ª–æ–∫–∏"
    ];
    const name = (file?.name || "").toLowerCase();
    if(name.includes("egg") || name.includes("—è–π")) return sets[0];
    if(name.includes("chick") || name.includes("–∫—É—Ä")) return sets[1];
    if(name.includes("fish") || name.includes("—Ä—ã–±")) return sets[2];
    return sets[Math.floor(Math.random() * sets.length)];
  }

  function smartMenuFromProducts(raw){
    const items = raw.split(",").map(s=>s.trim().toLowerCase()).filter(Boolean);
    const has = (k)=> items.some(x=>x.includes(k));

    const breakfast =
      has("–æ–≤—Å—è") ? "–û–≤—Å—è–Ω–∫–∞ + —è–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç—ã + —è–π—Ü–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)" :
      has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç + –æ—Ä–µ—Ö–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)" :
      has("—è–π—Ü")  ? "–û–º–ª–µ—Ç + –æ–≤–æ—â–∏" :
      "–ö–∞—à–∞/–π–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç";

    const lunch =
      (has("–∫—É—Ä") || has("–∏–Ω–¥–µ–π")) ? "–ë–µ–ª–æ–∫ (–∫—É—Ä–∏—Ü–∞/–∏–Ω–¥–µ–π–∫–∞) + –≥–∞—Ä–Ω–∏—Ä + —Å–∞–ª–∞—Ç" :
      has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏ + –≥–∞—Ä–Ω–∏—Ä (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" :
      (has("–≥—Ä–µ—á") || has("—Ä–∏—Å") || has("–∫–∞—Ä—Ç–æ")) ? "–ì–∞—Ä–Ω–∏—Ä + –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫ (—á—Ç–æ –µ—Å—Ç—å)" :
      "–¢—ë–ø–ª–∞—è —Ç–∞—Ä–µ–ª–∫–∞: –±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + –Ω–µ–º–Ω–æ–≥–æ –≥–∞—Ä–Ω–∏—Ä–∞";

    const snack =
      has("–π–æ–≥—É—Ä") ? "–ô–æ–≥—É—Ä—Ç + —è–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç" :
      has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç" :
      has("–∫–µ—Ñ") ? "–ö–µ—Ñ–∏—Ä/—Ä—è–∂–µ–Ω–∫–∞ + —Ñ—Ä—É–∫—Ç" :
      "–§—Ä—É–∫—Ç + –≤–æ–¥–∞";

    const dinner =
      has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏" :
      has("—è–π—Ü") ? "–û–º–ª–µ—Ç/—è–π—Ü–∞ + —Å–∞–ª–∞—Ç" :
      has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —è–≥–æ–¥—ã (–µ—Å–ª–∏ –ø–æ–∑–¥–Ω–æ)" :
      "–û–≤–æ—â–∏ + –ª—ë–≥–∫–∏–π –±–µ–ª–æ–∫";

    return { breakfast, lunch, snack, dinner };
  }

  function renderSmart(title, raw, menu){
    smartOut.style.display = "block";
    smartOut.innerHTML = `
      <div class="menuCard">
        <h3>${title}</h3>
        <p>–ù–∞ –æ—Å–Ω–æ–≤–µ: <b>${raw}</b>. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–Ω—è.</p>
        <ul>
          <li><b>ü´ê –ó–∞–≤—Ç—Ä–∞–∫:</b> ${menu.breakfast}</li>
          <li><b>üç≤ –û–±–µ–¥:</b> ${menu.lunch}</li>
          <li><b>üçè –ü–µ—Ä–µ–∫—É—Å:</b> ${menu.snack}</li>
          <li><b>ü•ó –£–∂–∏–Ω:</b> ${menu.dinner}</li>
        </ul>
        <div class="small">ü§ç –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –¥–æ–º–∞ ‚Äî –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–æ–∫—É–ø–æ–∫.</div>
      </div>
    `;
  }

  // Events (reliable!)
  calcBtn.addEventListener("click", () => {
    const w = parseNum(weightEl.value);
    const h = parseNum(heightEl.value);
    const a = parseNum(ageEl.value);

    calcAlert.style.display = "none";

    if(!Number.isFinite(w) || !Number.isFinite(h) || !Number.isFinite(a) || w<=0 || h<=0 || a<=0){
      calcAlert.style.display = "block";
      resultEl.style.display = "none";
      lastCalculated = null;
      return;
    }

    const gender = genderEl.value;
    const act = parseNum(activityEl.value);
    const goal = parseNum(goalEl.value);

    const bmr = mifflinStJeor(w, h, a, gender);
    let cal = round(bmr * act * goal);
    cal = clamp(cal, 1200, 3000);

    // macros
    const p = round(w * 1.3);
    const f = round(w * 0.9);
    const c = Math.max(0, round((cal - (p*4 + f*9)) / 4));

    calValEl.textContent = String(cal);
    macroLineEl.textContent = `–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: –±–µ–ª–∫–∏ ${p} –≥ ‚Ä¢ –∂–∏—Ä—ã ${f} –≥ ‚Ä¢ —É–≥–ª–µ–≤–æ–¥—ã ${c} –≥`;

    const split = kcalSplit(cal);
    renderMeals(split);
    renderDayMenu(split);
    renderWeekMenu(cal, split);

    // store copy texts
    lastCalculated = {
      cal,
      split,
      dayText: toPlainTextDay(cal, split),
      weekText: toPlainTextWeek(cal, split)
    };

    resultEl.style.display = "block";
    dayMenu.style.display = "block";
    weekMenu.style.display = "none";
    setActiveTab("day");
  });

  tabDay.addEventListener("click", ()=> setActiveTab("day"));
  tabWeek.addEventListener("click", ()=> setActiveTab("week"));

  copyBtn.addEventListener("click", async () => {
    if(!lastCalculated){
      alert("–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª üôÇ");
      return;
    }
    const text = buildCopyText();
    const ok = await copyToClipboard(text);
    alert(ok ? "–ú–µ–Ω—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ. –ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å –≤ Telegram üôÇ" : "–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä.");
  });

  photoEl.addEventListener("change", (e)=>{
    const file = e.target.files && e.target.files[0] ? e.target.files[0] : null;
    recognizedText = file ? simulatePhotoToText(file) : "";
  });

  fillFromPhotoBtn.addEventListener("click", ()=>{
    smartAlert.style.display = "none";
    const file = photoEl.files && photoEl.files[0] ? photoEl.files[0] : null;
    if(!file){
      smartAlert.textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ, –∞ –ø–æ—Ç–æ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª.";
      smartAlert.style.display = "block";
      return;
    }
    if(!recognizedText) recognizedText = simulatePhotoToText(file);
    productsEl.value = recognizedText;
  });

  smartBtn.addEventListener("click", ()=>{
    smartAlert.style.display = "none";
    const raw = productsEl.value.trim();
    if(!raw){
      smartAlert.textContent = "–î–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª).";
      smartAlert.style.display = "block";
      smartOut.style.display = "none";
      return;
    }
    const menu = smartMenuFromProducts(raw);
    renderSmart("–ú–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å", raw, menu);
  });

})();
</script>
</body>
</html>
