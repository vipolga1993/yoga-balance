<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ ‚Äî –π–æ–≥–∞ –∏ –±–∞–ª–∞–Ω—Å</title>

<style>
:root{
  --bg:#f6f7f5;
  --card:#ffffff;
  --green:#6fbf8a;
  --green-dark:#2f6f4f;
  --text:#1f1f1f;
  --muted:#6a6a6a;
  --radius:18px;
  --line:#e9e9e9;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}
.wrap{max-width:980px;margin:auto;padding:24px}
h1{margin:0 0 6px;font-size:34px}
.subtitle{color:var(--muted);margin:0 0 20px}
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  margin:18px 0;
  box-shadow:0 10px 30px rgba(0,0,0,.06);
}
h2{margin:0 0 14px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:780px){.grid{grid-template-columns:1fr}}
label{font-size:13px;color:var(--muted)}
input,select,textarea,button{
  width:100%;
  padding:12px 14px;
  border-radius:12px;
  border:1px solid #ddd;
  font-size:16px;
  background:#fff;
}
textarea{min-height:84px;resize:vertical}
button{
  border:none;
  background:var(--green);
  color:#fff;
  font-weight:700;
  font-size:18px;
  padding:16px;
  cursor:pointer;
}
button:hover{background:var(--green-dark)}
button.secondary{
  background:#e7f3ec;
  color:var(--green-dark);
}
.row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.pill{
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--line);
  background:#fff;
  cursor:pointer;
  font-weight:600;
  color:#2a2a2a;
}
.pill.active{
  border-color:var(--green);
  box-shadow:0 6px 18px rgba(111,191,138,.22);
}
.hr{height:1px;background:var(--line);margin:16px 0}
.kcal{font-size:22px;font-weight:800;margin:8px 0}
.small{color:var(--muted);font-size:14px}
.week{margin-top:10px}
.day{
  padding:12px 0;
  border-bottom:1px solid var(--line);
  line-height:1.55;
}
.tag{
  display:inline-block;
  padding:6px 10px;
  border-radius:999px;
  background:#f1f6f3;
  color:#2f6f4f;
  font-size:12px;
  font-weight:700;
  margin-left:6px;
}
.preview{
  display:none;
  margin-top:10px;
  border-radius:14px;
  border:1px solid var(--line);
  overflow:hidden;
  background:#fafafa;
}
.preview img{width:100%;display:block;max-height:260px;object-fit:cover}
.warn{
  padding:12px 14px;
  border-radius:12px;
  background:#fff7e6;
  border:1px solid #ffe2a8;
  color:#5b4500;
  font-size:14px;
}
</style>
</head>

<body>
<div class="wrap">

<h1>ü•ó –ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</h1>
<p class="subtitle">–í–∞—É-–ø—Ä–æ—Ç–æ—Ç–∏–ø: —Å—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞ + –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é + ‚Äú—É–º–Ω–æ–µ –º–µ–Ω—é‚Äù –∏–∑ –≤–∞—à–∏—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–≤–≤–æ–¥ –∏–ª–∏ —Ñ–æ—Ç–æ)</p>

<!-- 1) –†–ê–°–ß–Å–¢ -->
<div class="card">
  <h2>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
  <div class="grid">
    <div>
      <label>–í–µ—Å (–∫–≥)</label>
      <input id="weight" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 68">
    </div>
    <div>
      <label>–†–æ—Å—Ç (—Å–º)</label>
      <input id="height" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 168">
    </div>
    <div>
      <label>–í–æ–∑—Ä–∞—Å—Ç</label>
      <input id="age" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä, 37">
    </div>
    <div>
      <label>–ü–æ–ª</label>
      <select id="gender">
        <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
        <option value="male">–ú—É–∂—Å–∫–æ–π</option>
      </select>
    </div>
    <div>
      <label>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
      <select id="activity">
        <option value="1.2">–ô–æ–≥–∞ 1 —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é</option>
        <option value="1.3">–ô–æ–≥–∞ 2‚Äì3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
        <option value="1.45">–ô–æ–≥–∞ 4+ —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
      </select>
    </div>
    <div>
      <label>–¶–µ–ª—å</label>
      <select id="goal">
        <option value="0.9">–ú—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</option>
        <option value="1">–ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</option>
        <option value="1.05">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º—ã</option>
      </select>
    </div>
  </div>

  <button id="btnCalc" type="button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

  <div id="calcOut" style="display:none;margin-top:14px">
    <div class="kcal" id="dailyKcal"></div>
    <div class="small" id="splitKcal"></div>
    <div class="hr"></div>
    <div class="small"><b>–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£</b>: <span id="macros"></span></div>
  </div>
</div>

<!-- 2) –ú–ï–ù–Æ –ù–ê –ù–ï–î–ï–õ–Æ -->
<div class="card" id="weekCard" style="display:none">
  <h2>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é (–≤–∞—É-–ø–ª–∞–Ω)</h2>
  <div class="small">–°–æ–±—Ä–∞–Ω–æ –ø–æ–¥ –≤–∞—à—É —Å—É—Ç–æ—á–Ω—É—é –Ω–æ—Ä–º—É –∏ —Ü–µ–ª—å. –ù–∏–∂–µ ‚Äî 7 –¥–Ω–µ–π, —Å –∏–¥–µ—è–º–∏ –±–ª—é–¥ –∏ –ø–æ—Ä—Ü–∏—è–º–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ).</div>
  <div class="week" id="weekOut"></div>
</div>

<!-- 3) –£–ú–ù–û–ï –ú–ï–ù–Æ –ò–ó –ü–†–û–î–£–ö–¢–û–í: –í–í–û–î –ò–õ–ò –§–û–¢–û -->
<div class="card">
  <h2>–£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å</h2>

  <div class="row" style="margin-bottom:12px">
    <div class="pill active" id="tabList">–í–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫</div>
    <div class="pill" id="tabPhoto">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</div>
  </div>

  <!-- –í–∞—Ä–∏–∞–Ω—Ç: —Å–ø–∏—Å–æ–∫ -->
  <div id="panelList">
    <label>–ü—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
    <input id="productsList" placeholder="—è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤–æ—â–∏, –æ–≤—Å—è–Ω–∫–∞, –∫—É—Ä–∏—Ü–∞">
    <button class="secondary" id="btnSmartList" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –∏–∑ —Å–ø–∏—Å–∫–∞</button>
  </div>

  <!-- –í–∞—Ä–∏–∞–Ω—Ç: —Ñ–æ—Ç–æ -->
  <div id="panelPhoto" style="display:none">
    <div class="warn">
      –í–∞–∂–Ω–æ: —ç—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø –±–µ–∑ AI-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è. –ü–æ—ç—Ç–æ–º—É —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç–∞–∫–æ–π:
      <b>–∑–∞–≥—Ä—É–∂–∞–µ—Ç–µ —Ñ–æ—Ç–æ ‚Üí –≤–∏–¥–∏—Ç–µ –ø—Ä–µ–≤—å—é ‚Üí –∫–æ—Ä–æ—Ç–∫–æ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç–µ, —á—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ</b> (—ç—Ç–æ –±—ã—Å—Ç—Ä–µ–µ, —á–µ–º –ø–µ—á–∞—Ç–∞—Ç—å –≤—Å—ë —Å –Ω—É–ª—è).
    </div>
    <div style="margin-top:12px">
      <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ / –ø—Ä–æ–¥—É–∫—Ç–æ–≤</label>
      <input id="photo" type="file" accept="image/*">
      <div class="preview" id="previewBox"><img id="previewImg" alt="preview"></div>
    </div>
    <div style="margin-top:12px">
      <label>–ß—Ç–æ –Ω–∞ —Ñ–æ—Ç–æ (–∫—Ä–∞—Ç–∫–æ, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
      <input id="productsFromPhoto" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —è–π—Ü–∞, –º–æ–ª–æ–∫–æ, —Ç–≤–æ—Ä–æ–≥, –æ–≥—É—Ä—Ü—ã, –∫—É—Ä–∏—Ü–∞">
      <button class="secondary" id="btnSmartPhoto" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –ø–æ —Ñ–æ—Ç–æ</button>
    </div>
  </div>

  <div class="hr"></div>
  <div id="smartOut" class="week"></div>
</div>

<p class="small">‚ö†Ô∏è –ü—Ä–æ—Ç–æ—Ç–∏–ø –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.</p>

</div>

<script>
/* ===== –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã (—á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∏ –Ω–µ ‚Äú–ª–æ–º–∞–ª–∏—Å—å‚Äù) ===== */
const $ = (id) => document.getElementById(id);

const el = {
  weight: $("weight"),
  height: $("height"),
  age: $("age"),
  gender: $("gender"),
  activity: $("activity"),
  goal: $("goal"),
  btnCalc: $("btnCalc"),
  calcOut: $("calcOut"),
  dailyKcal: $("dailyKcal"),
  splitKcal: $("splitKcal"),
  macros: $("macros"),
  weekCard: $("weekCard"),
  weekOut: $("weekOut"),

  tabList: $("tabList"),
  tabPhoto: $("tabPhoto"),
  panelList: $("panelList"),
  panelPhoto: $("panelPhoto"),

  productsList: $("productsList"),
  btnSmartList: $("btnSmartList"),

  photo: $("photo"),
  previewBox: $("previewBox"),
  previewImg: $("previewImg"),
  productsFromPhoto: $("productsFromPhoto"),
  btnSmartPhoto: $("btnSmartPhoto"),

  smartOut: $("smartOut"),
};

let lastDailyKcal = 1800; // –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç, –µ—Å–ª–∏ —Ä–∞—Å—á—ë—Ç –µ—â—ë –Ω–µ —Å–¥–µ–ª–∞–ª–∏

/* ===== –†–∞—Å—á—ë—Ç –∫–∞–ª–æ—Ä–∏–π ===== */
function calc(){
  const w = Number(el.weight.value);
  const h = Number(el.height.value);
  const a = Number(el.age.value);

  if(!w || !h || !a){
    alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç");
    return;
  }

  const g = el.gender.value;
  const act = Number(el.activity.value);
  const goal = Number(el.goal.value);

  const bmr = (g === "female")
    ? (10*w + 6.25*h - 5*a - 161)
    : (10*w + 6.25*h - 5*a + 5);

  const kcal = Math.round(bmr * act * goal);
  lastDailyKcal = kcal;

  // –ë–ñ–£ (–º—è–≥–∫–æ, –æ—Ä–∏–µ–Ω—Ç–∏—Ä)
  const p = Math.round(w * 1.4);     // –±–µ–ª–æ–∫
  const f = Math.round(w * 0.9);     // –∂–∏—Ä
  const c = Math.max(0, Math.round((kcal - (p*4 + f*9))/4)); // —É–≥–ª–µ–≤–æ–¥—ã

  // —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—ë–º–∞–º
  const b = Math.round(kcal*0.30);
  const l = Math.round(kcal*0.35);
  const s = Math.round(kcal*0.15);
  const d = kcal - b - l - s;

  el.dailyKcal.textContent = `–°—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞: ${kcal} –∫–∫–∞–ª`;
  el.splitKcal.innerHTML = `
    <b>–ü—Ä–∏–º–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:</b><br>
    –ó–∞–≤—Ç—Ä–∞–∫: ~30% (${b} –∫–∫–∞–ª)<br>
    –û–±–µ–¥: ~35% (${l} –∫–∫–∞–ª)<br>
    –ü–µ—Ä–µ–∫—É—Å: ~15% (${s} –∫–∫–∞–ª)<br>
    –£–∂–∏–Ω: ~20% (${d} –∫–∫–∞–ª)
  `;
  el.macros.textContent = `–±–µ–ª–∫–∏ ${p} –≥ ‚Ä¢ –∂–∏—Ä—ã ${f} –≥ ‚Ä¢ —É–≥–ª–µ–≤–æ–¥—ã ${c} –≥`;
  el.calcOut.style.display = "block";

  renderWeekMenu(kcal, {b,l,s,d});
}

/* ===== ‚Äú–í–∞—É‚Äù –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é ===== */
function renderWeekMenu(kcal, split){
  const days = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞","–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"];

  // –ø—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –±–ª—é–¥ (–±–µ–∑ —Ñ–∞–Ω–∞—Ç–∏–∑–º–∞, –Ω–æ –ø—Ä–µ–∑–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ)
  const breakfasts = [
    "–û–≤—Å—è–Ω–∫–∞ + —è–≥–æ–¥—ã + –π–æ–≥—É—Ä—Ç",
    "–¢–≤–æ—Ä–æ–≥ + –≥—Ä—É—à–∞/—è–±–ª–æ–∫–æ + –æ—Ä–µ—Ö–∏",
    "–û–º–ª–µ—Ç –∏–∑ 2 —è–∏—Ü + –æ–≤–æ—â–∏",
    "–ì—Ä–µ—á–∫–∞ + —è–π—Ü–æ + –æ–≤–æ—â–∏",
  ];
  const lunches = [
    "–ö—É—Ä–∏—Ü–∞/–∏–Ω–¥–µ–π–∫–∞ + –∫—Ä—É–ø–∞ + —Å–∞–ª–∞—Ç",
    "–†—ã–±–∞ + –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å/—Ä–∏—Å + –æ–≤–æ—â–∏",
    "–¢—É—à—ë–Ω—ã–µ –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫ (–∫—É—Ä–∏—Ü–∞/—Ç–æ—Ñ—É)",
    "–°—É–ø + —Ü–µ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–π —Ö–ª–µ–± + —Å–∞–ª–∞—Ç",
  ];
  const snacks = [
    "–¢–≤–æ—Ä–æ–≥ –∏–ª–∏ –π–æ–≥—É—Ä—Ç",
    "–§—Ä—É–∫—Ç + –≥–æ—Ä—Å—Ç—å –æ—Ä–µ—Ö–æ–≤",
    "–•—É–º—É—Å + –æ–≤–æ—â–∏",
    "–ö–µ—Ñ–∏—Ä/—Ä—è–∂–µ–Ω–∫–∞",
  ];
  const dinners = [
    "–†—ã–±–∞/–∫—É—Ä–∏—Ü–∞ + –æ–≤–æ—â–∏",
    "–¢–≤–æ—Ä–æ–≥ + —è–≥–æ–¥—ã (–µ—Å–ª–∏ –ø–æ–∑–¥–Ω–æ)",
    "–¢—É—à—ë–Ω—ã–µ –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫",
    "–°–∞–ª–∞—Ç + –±–µ–ª–æ–∫ + –æ–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ",
  ];

  function portionHint(mealKcal, meal){
    // –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ü–∏–∏ –¥–ª—è ‚Äú–≤–∞—É‚Äù: –ø–æ–Ω—è—Ç–Ω—ã–µ –≥—Ä–∞–º–º—ã
    // (–æ—á–µ–Ω—å –≥—Ä—É–±–æ, –Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø—Ä–æ–¥—É–∫—Ç)
    if(meal.includes("–¢–≤–æ—Ä–æ–≥")) return `–ü–æ—Ä—Ü–∏—è: —Ç–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ (‚âà ${mealKcal} –∫–∫–∞–ª)`;
    if(meal.includes("–û–≤—Å—è–Ω–∫–∞")) return `–ü–æ—Ä—Ü–∏—è: –æ–≤—Å—è–Ω–∫–∞ 60‚Äì70 –≥ —Å—É—Ö–æ–π + –π–æ–≥—É—Ä—Ç 150 –≥ (‚âà ${mealKcal} –∫–∫–∞–ª)`;
    if(meal.includes("–û–º–ª–µ—Ç")) return `–ü–æ—Ä—Ü–∏—è: 2 —è–π—Ü–∞ + –æ–≤–æ—â–∏ 250‚Äì300 –≥ (‚âà ${mealKcal} –∫–∫–∞–ª)`;
    if(meal.includes("–ö—É—Ä–∏—Ü–∞") || meal.includes("–∏–Ω–¥–µ–π–∫–∞")) return `–ü–æ—Ä—Ü–∏—è: –±–µ–ª–æ–∫ 140‚Äì170 –≥ + –≥–∞—Ä–Ω–∏—Ä 150‚Äì200 –≥ (‚âà ${mealKcal} –∫–∫–∞–ª)`;
    if(meal.includes("–†—ã–±–∞")) return `–ü–æ—Ä—Ü–∏—è: —Ä—ã–±–∞ 160‚Äì200 –≥ + –æ–≤–æ—â–∏ 250 –≥ (‚âà ${mealKcal} –∫–∫–∞–ª)`;
    return `–ü–æ—Ä—Ü–∏—è: –ø–æ–¥ ${mealKcal} –∫–∫–∞–ª`;
  }

  let html = "";
  for(let i=0;i<7;i++){
    const b = breakfasts[i % breakfasts.length];
    const l = lunches[i % lunches.length];
    const s = snacks[i % snacks.length];
    const d = dinners[i % dinners.length];

    html += `
      <div class="day">
        <b>${days[i]}</b> <span class="tag">${kcal} –∫–∫–∞–ª/–¥–µ–Ω—å</span><br>
        <b>–ó–∞–≤—Ç—Ä–∞–∫</b> (${split.b} –∫–∫–∞–ª): ${b}<br><span class="small">${portionHint(split.b,b)}</span><br>
        <b>–û–±–µ–¥</b> (${split.l} –∫–∫–∞–ª): ${l}<br><span class="small">${portionHint(split.l,l)}</span><br>
        <b>–ü–µ—Ä–µ–∫—É—Å</b> (${split.s} –∫–∫–∞–ª): ${s}<br><span class="small">${portionHint(split.s,s)}</span><br>
        <b>–£–∂–∏–Ω</b> (${split.d} –∫–∫–∞–ª): ${d}<br><span class="small">${portionHint(split.d,d)}</span>
      </div>
    `;
  }

  el.weekOut.innerHTML = html;
  el.weekCard.style.display = "block";
}

/* ===== –£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: —Å–ø–∏—Å–æ–∫/—Ñ–æ—Ç–æ ===== */
function normalizeList(text){
  return text
    .split(",")
    .map(s=>s.trim().toLowerCase())
    .filter(Boolean);
}

function buildSmartMenu(rawText){
  const items = normalizeList(rawText);
  if(items.length === 0){
    el.smartOut.innerHTML = "<span class='small'>–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –º–µ–Ω—é.</span>";
    return;
  }

  // –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è ‚Äú–ª–æ–≥–∏–∫–∞ –ø–æ–¥ –ø—Ä–æ–¥—É–∫—Ç—ã‚Äù: –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω—ã
  const has = (word) => items.some(x=>x.includes(word));
  const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];

  const breakfast = has("–æ–≤—Å—è") ? "–û–≤—Å—è–Ω–∫–∞ –Ω–∞ –≤–æ–¥–µ/–º–æ–ª–æ–∫–µ + —Ñ—Ä—É–∫—Ç" :
                   has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç + 1 —á.–ª. –º—ë–¥–∞/—è–≥–æ–¥—ã" :
                   has("—è–π—Ü") ? "–û–º–ª–µ—Ç/—è–π—Ü–∞ + –æ–≤–æ—â–∏" :
                   "–ö–∞—à–∞/–π–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç";

  const lunch = has("–∫—É—Ä") || has("–∏–Ω–¥–µ–π") ? "–ö—É—Ä–∏—Ü–∞/–∏–Ω–¥–µ–π–∫–∞ + –≥–∞—Ä–Ω–∏—Ä + —Å–∞–ª–∞—Ç" :
                has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏ + –≥–∞—Ä–Ω–∏—Ä" :
                "–°—É–ø/—Ä–∞–≥—É + —Å–∞–ª–∞—Ç";

  const snack = has("–∫–µ—Ñ") || has("–π–æ–≥—É—Ä") ? "–ö–µ—Ñ–∏—Ä/–π–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç" :
                has("–æ—Ä–µ—Ö") ? "–§—Ä—É–∫—Ç + –≥–æ—Ä—Å—Ç—å –æ—Ä–µ—Ö–æ–≤" :
                "–§—Ä—É–∫—Ç –∏–ª–∏ —Ç–≤–æ—Ä–æ–≥";

  const dinner = has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏" :
                 has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —è–≥–æ–¥—ã (–µ—Å–ª–∏ –ø–æ–∑–¥–Ω–æ)" :
                 "–û–≤–æ—â–∏ + –±–µ–ª–æ–∫";

  const kcal = lastDailyKcal;
  const b = Math.round(kcal*0.30);
  const l = Math.round(kcal*0.35);
  const s = Math.round(kcal*0.15);
  const d = kcal - b - l - s;

  el.smartOut.innerHTML = `
    <div class="small"><b>–í–∞—à–∏ –ø—Ä–æ–¥—É–∫—Ç—ã:</b> ${items.join(", ")}</div>
    <div class="hr"></div>
    <div class="day" style="border-bottom:none;padding-bottom:0">
      <b>–ú–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å</b> <span class="tag">${kcal} –∫–∫–∞–ª/–¥–µ–Ω—å</span><br>
      <b>–ó–∞–≤—Ç—Ä–∞–∫</b> (${b} –∫–∫–∞–ª): ${breakfast}<br>
      <b>–û–±–µ–¥</b> (${l} –∫–∫–∞–ª): ${lunch}<br>
      <b>–ü–µ—Ä–µ–∫—É—Å</b> (${s} –∫–∫–∞–ª): ${snack}<br>
      <b>–£–∂–∏–Ω</b> (${d} –∫–∫–∞–ª): ${dinner}<br><br>
      <span class="small"><i>–≠—Ç–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø: –æ–Ω –¥–µ–ª–∞–µ—Ç —É–º–Ω—ã–π –ø–æ–¥–±–æ—Ä –ø–æ —Å–ø–∏—Å–∫—É/–ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∞–≤—Ç–æ-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ ‚Äî –ø–æ–¥–∫–ª—é—á–∏–º AI-–º–æ–¥—É–ª—å.</i></span>
    </div>
  `;
}

/* ===== –¢–∞–±—ã ===== */
function setTab(mode){
  const isList = mode === "list";
  el.tabList.classList.toggle("active", isList);
  el.tabPhoto.classList.toggle("active", !isList);
  el.panelList.style.display = isList ? "block" : "none";
  el.panelPhoto.style.display = isList ? "none" : "block";
  el.smartOut.innerHTML = "";
}

/* ===== –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ ===== */
el.photo.addEventListener("change", (e)=>{
  const file = e.target.files && e.target.files[0];
  if(!file){ el.previewBox.style.display="none"; return; }
  const url = URL.createObjectURL(file);
  el.previewImg.src = url;
  el.previewBox.style.display = "block";
});

/* ===== –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ ===== */
el.btnCalc.addEventListener("click", calc);
el.btnSmartList.addEventListener("click", ()=>buildSmartMenu(el.productsList.value));
el.btnSmartPhoto.addEventListener("click", ()=>buildSmartMenu(el.productsFromPhoto.value));

el.tabList.addEventListener("click", ()=>setTab("list"));
el.tabPhoto.addEventListener("click", ()=>setTab("photo"));

// —Å—Ç–∞—Ä—Ç
setTab("list");
</script>

</body>
</html>
