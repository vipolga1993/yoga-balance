<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ ‚Äî —ç–Ω–µ—Ä–≥–∏—è –∏ –π–æ–≥–∞</title>

  <style>
    :root{
      --bg:#f6faf7;
      --card:#ffffff;
      --text:#1f2a24;
      --muted:#5f6b63;
      --green:#67c08a;
      --green2:#2f6b4b;
      --line:#e6efe8;
      --radius:18px;
      --shadow: 0 12px 28px rgba(0,0,0,.06);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px 600px at 20% 0%, #effaf2, transparent 60%),
                  radial-gradient(900px 500px at 90% 20%, #f1f7ff, transparent 55%),
                  var(--bg);
      color:var(--text);
    }

    .wrap{max-width:980px;margin:0 auto;padding:22px}
    .top{
      display:flex;align-items:center;gap:14px;margin:8px 0 18px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      display:grid;place-items:center;
      background:#e9f7ee;border:1px solid var(--line);
      font-size:22px;
    }
    h1{margin:0;font-size:30px;letter-spacing:-.2px;color:var(--green2)}
    .subtitle{margin:4px 0 0;color:var(--muted)}

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      margin:16px 0;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top:10px;
    }
    @media(max-width:820px){ .grid{grid-template-columns:1fr} }

    label{
      display:block;
      font-size:14px;
      color:var(--muted);
      margin-bottom:6px;
    }
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fbfdfb;
      font-size:16px;
      outline:none;
    }
    textarea{min-height:86px;resize:vertical}

    .row{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px;
    }

    .btn{
      width:100%;
      border:none;
      border-radius:16px;
      padding:14px 16px;
      font-size:17px;
      font-weight:700;
      cursor:pointer;
      background:var(--green);
      color:#fff;
      transition:.15s transform ease, .15s opacity ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn.secondary{
      background:#e8f6ee;
      color:var(--green2);
      border:1px solid var(--line);
    }

    .pill{
      display:inline-flex;gap:8px;align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fbfdfb;
      color:var(--muted);
      font-size:13px;
    }

    .section-title{
      margin:0 0 6px;
      font-size:20px;
      color:#0f1a14;
    }
    .muted{color:var(--muted);margin:0}

    .out{
      margin-top:12px;
      border-top:1px dashed var(--line);
      padding-top:12px;
    }

    .kcalBox{
      background:#f1fbf5;
      border:1px solid #d8f0e1;
      border-radius:16px;
      padding:12px 14px;
      margin:10px 0 0;
      font-size:16px;
    }
    .kcalBig{
      font-weight:800;
      color:var(--green2);
      font-size:20px;
    }

    .list{
      margin:10px 0 0;
      padding-left:18px;
      line-height:1.65;
    }

    .menuTabs{
      display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;
    }
    .tabBtn{
      border:1px solid var(--line);
      background:#fbfdfb;
      color:var(--green2);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:700;
    }
    .tabBtn.active{
      background:#e9f7ee;
      border-color:#cfead9;
    }

    .menuBox{
      margin-top:12px;
      background:#f7fbf8;
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      line-height:1.7;
    }

    .hint{
      margin-top:10px;
      font-size:13px;
      color:var(--muted);
    }

    .footerWarn{
      font-size:12px;color:var(--muted);
      margin-top:12px;
    }

    .smallNote{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
    }

    .twoCols{
      display:grid;
      grid-template-columns:1.1fr .9fr;
      gap:14px;
    }
    @media(max-width:820px){ .twoCols{grid-template-columns:1fr} }

    .tag{
      display:inline-block;
      padding:6px 10px;
      border-radius:999px;
      background:#eef7ff;
      border:1px solid #dfefff;
      color:#24557a;
      font-size:12px;
      font-weight:700;
      margin-right:8px;
      margin-top:8px;
    }

    .divider{height:1px;background:var(--line);margin:12px 0}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="logo">ü•ó</div>
      <div>
        <h1>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</h1>
        <p class="subtitle">–ú—è–≥–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø–∏—Ç–∞–Ω–∏—è –¥–ª—è –∂–µ–Ω—â–∏–Ω 30‚Äì45, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∞–∫—Ç–∏–∫—É—é—Ç –π–æ–≥—É –∏ —Ö–æ—Ç—è—Ç —Å–Ω–∏–∂–∞—Ç—å –≤–µ—Å –±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –¥–∏–µ—Ç.</p>
      </div>
    </div>

    <!-- –ü–ï–†–°–û–ù–ê–õ–¨–ù–´–ô –†–ê–°–ß–Å–¢ -->
    <div class="card" id="calcCard">
      <h2 class="section-title">–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
      <p class="muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî –ø–æ–ª—É—á–∏—Ç–µ —Å—É—Ç–æ—á–Ω—É—é –Ω–æ—Ä–º—É –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—ë–º–∞–º –ø–∏—â–∏.</p>

      <div class="grid">
        <div>
          <label for="weight">–í–µ—Å (–∫–≥)</label>
          <input id="weight" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 72">
        </div>
        <div>
          <label for="height">–†–æ—Å—Ç (—Å–º)</label>
          <input id="height" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 168">
        </div>
        <div>
          <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
          <input id="age" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 36">
        </div>
        <div>
          <label for="gender">–ü–æ–ª</label>
          <select id="gender">
            <option value="female" selected>–ñ–µ–Ω—Å–∫–∏–π</option>
            <option value="male">–ú—É–∂—Å–∫–æ–π</option>
          </select>
        </div>
        <div>
          <label for="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</label>
          <select id="activity">
            <option value="1.35">–ô–æ–≥–∞ 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
            <option value="1.50">–ô–æ–≥–∞ 2‚Äì3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
            <option value="1.65">–ô–æ–≥–∞ 3‚Äì4 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é</option>
            <option value="1.80">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</option>
          </select>
        </div>
        <div>
          <label for="goal">–¶–µ–ª—å</label>
          <select id="goal">
            <option value="0.90" selected>–ú—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</option>
            <option value="1.00">–ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</option>
            <option value="1.05">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º—ã</option>
          </select>
        </div>
      </div>

      <div class="row">
        <span class="pill">‚ú® ‚Äú–û–≥–æ-—ç—Ñ—Ñ–µ–∫—Ç‚Äù: —Å—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞ + —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ + –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–ª–∞–Ω</span>
      </div>

      <button class="btn" id="calcBtn" type="button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>

      <div class="out" id="calcOut" style="display:none">
        <div class="kcalBox">
          <div><b>–°—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞:</b> <span class="kcalBig" id="dailyKcal">‚Äî</span> –∫–∫–∞–ª</div>
          <div class="smallNote" id="macroLine">‚Äî</div>
        </div>

        <div class="menuBox">
          <b>–ü—Ä–∏–º–µ—Ä —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø—Ä–∏—ë–º–∞–º –ø–∏—â–∏:</b>
          <ul class="list" id="splitList"></ul>
          <div class="smallNote" id="coachHint">–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –π–æ–≥–∏ –∏ –º—è–≥–∫–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞.</div>
        </div>

        <div class="menuTabs" aria-label="–í—ã–±–æ—Ä –ø–ª–∞–Ω–∞">
          <button class="tabBtn active" id="tabDay" type="button">–ü–æ–∫–∞–∑–∞—Ç—å 1 –¥–µ–Ω—å</button>
          <button class="tabBtn" id="tabWeek" type="button">–ü–æ–∫–∞–∑–∞—Ç—å –Ω–µ–¥–µ–ª—é</button>
        </div>

        <div class="menuBox" id="dayMenuBox"></div>
        <div class="hint">–ü–ª–∞–Ω ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ—Ç–æ—Ç–∏–ø (–µ–≥–æ –º–æ–∂–Ω–æ –¥–∞–ª—å—à–µ ‚Äú–Ω–∞—Ç–∞—Å–∫–∏–≤–∞—Ç—å‚Äù –ø–æ–¥ —Å—Ç–∏–ª—å —Ç—Ä–µ–Ω–µ—Ä–∞).</div>
      </div>
    </div>

    <!-- –£–ú–ù–û–ï –ú–ï–ù–Æ -->
    <div class="card">
      <h2 class="section-title">–£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
      <p class="muted">–î–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: <b>–≤–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫</b> –∏–ª–∏ <b>–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ</b> (–∏–º–∏—Ç–∞—Ü–∏—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è ‚Äî –¥–ª—è –≤–∞—É-–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞).</p>

      <div class="twoCols">
        <div>
          <label for="products">–ü—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
          <textarea id="products" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, —è–±–ª–æ–∫–∏, –æ–≤–æ—â–∏"></textarea>

          <div class="row">
            <button class="btn secondary" id="menuFromTextBtn" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –∏–∑ —Å–ø–∏—Å–∫–∞</button>
          </div>

          <div class="divider"></div>

          <label for="photo">–§–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</label>
          <input id="photo" type="file" accept="image/*" />

          <div class="row">
            <button class="btn secondary" id="menuFromPhotoBtn" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –ø–æ —Ñ–æ—Ç–æ (–≤–∞—É-–¥–µ–º–æ)</button>
          </div>

          <div class="smallNote">
            –í–∞–∂–Ω–æ: —ç—Ç–æ <b>–∏–º–∏—Ç–∞—Ü–∏—è</b> —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è ‚Äî ‚Äú–∫–∞–∫ –±—É–¥—Ç–æ‚Äù AI –ø–æ–Ω—è–ª —Ñ–æ—Ç–æ. –î–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä/API.
          </div>
        </div>

        <div>
          <div class="tag">‚úÖ –ü—Ä–µ–∑–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ</div>
          <div class="tag">‚úÖ –ë–µ–∑ VPN</div>
          <div class="tag">‚úÖ GitHub Pages</div>

          <div class="menuBox" id="smartMenuBox" style="display:none"></div>
          <div class="footerWarn">‚ö†Ô∏è –ü—Ä–æ—Ç–æ—Ç–∏–ø –Ω–æ—Å–∏—Ç –æ–∑–Ω–∞–∫–æ–º–∏—Ç–µ–ª—å–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- –£–¢–ò–õ–ò–¢–´ ---
    function round(n){ return Math.round(n); }
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function parseNum(id){
      const el = document.getElementById(id);
      const v = Number(String(el.value).replace(",", "."));
      return v;
    }

    function setActiveTab(which){
      const tabDay = document.getElementById('tabDay');
      const tabWeek = document.getElementById('tabWeek');
      tabDay.classList.toggle('active', which === 'day');
      tabWeek.classList.toggle('active', which === 'week');
    }

    // --- –†–ê–°–ß–Å–¢ –ö–ê–õ–û–†–ò–ô ---
    function calcAndRender(){
      const w = parseNum('weight');
      const h = parseNum('height');
      const a = parseNum('age');
      if(!w || !h || !a){
        alert('–ó–∞–ø–æ–ª–Ω–∏ –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç üôÇ');
        return;
      }

      const gender = document.getElementById('gender').value;
      const act = Number(document.getElementById('activity').value);
      const goal = Number(document.getElementById('goal').value);

      // Mifflin-St Jeor
      const bmr = (gender === 'male')
        ? (10*w + 6.25*h - 5*a + 5)
        : (10*w + 6.25*h - 5*a - 161);

      // –∏—Ç–æ–≥–æ–≤–∞—è —Å—É—Ç–æ—á–Ω–∞—è
      let daily = round(bmr * act * goal);

      // —Ä–∞–∑—É–º–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã (—á—Ç–æ–±—ã ‚Äú–Ω–µ —É–ª–µ—Ç–∞–ª–æ‚Äù)
      daily = clamp(daily, 1200, 3200);

      // –ë–ñ–£ (–æ—Ä–∏–µ–Ω—Ç–∏—Ä)
      const protein = round(w * 1.3);       // –≥
      const fat = round(w * 0.9);           // –≥
      const carbs = round((daily - (protein*4 + fat*9)) / 4);
      const carbsSafe = clamp(carbs, 80, 450);

      document.getElementById('dailyKcal').textContent = daily;
      document.getElementById('macroLine').textContent =
        `–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: –±–µ–ª–∫–∏ ${protein} –≥ ‚Ä¢ –∂–∏—Ä—ã ${fat} –≥ ‚Ä¢ —É–≥–ª–µ–≤–æ–¥—ã ${carbsSafe} –≥`;

      // —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –ø—Ä–∏—ë–º–∞–º
      const split = [
        {name:'ü•£ –ó–∞–≤—Ç—Ä–∞–∫', p:0.30},
        {name:'üç≤ –û–±–µ–¥', p:0.35},
        {name:'üçè –ü–µ—Ä–µ–∫—É—Å', p:0.15},
        {name:'ü•ó –£–∂–∏–Ω', p:0.20},
      ];

      const ul = document.getElementById('splitList');
      ul.innerHTML = '';
      split.forEach(s=>{
        const kcal = round(daily * s.p);
        const li = document.createElement('li');
        li.textContent = `${s.name}: ~${round(s.p*100)}% (${kcal} –∫–∫–∞–ª)`;
        ul.appendChild(li);
      });

      // –ø–æ–∫–∞–∑–∞—Ç—å –±–ª–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
      document.getElementById('calcOut').style.display = 'block';

      // –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –º–µ–Ω—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 –¥–µ–Ω—å)
      setActiveTab('day');
      renderMenuPlan(daily, 'day');
    }

    // --- –ü–õ–ê–ù –ú–ï–ù–Æ: 1 –î–ï–ù–¨ / –ù–ï–î–ï–õ–Ø ---
    function buildDayTemplate(dailyKcal){
      // –ø—Ä–∏–º–µ—Ä–Ω—ã–µ –∫–∞–ª–æ—Ä–∏–∏ –ø–æ –ø—Ä–∏—ë–º–∞–º (–∫–∞–∫ –≤—ã—à–µ)
      const bk = round(dailyKcal*0.30);
      const lk = round(dailyKcal*0.35);
      const sk = round(dailyKcal*0.15);
      const dk = round(dailyKcal*0.20);

      // ‚Äú–û–≥–æ-—ç—Ñ—Ñ–µ–∫—Ç‚Äù: –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ + –≥—Ä–∞–º–º–æ–≤–∫–∏
      return {
        breakfast: {
          kcal: bk,
          text: `–û–≤—Å—è–Ω–∫–∞ –Ω–∞ –≤–æ–¥–µ/–º–æ–ª–æ–∫–µ 60 –≥ —Å—É—Ö–æ–π + —è–≥–æ–¥—ã 100 –≥ + 1 —á.–ª. –º—ë–¥–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é) + —è–π—Ü–æ 1‚Äì2 —à—Ç`
        },
        lunch: {
          kcal: lk,
          text: `–¢—ë–ø–ª–∞—è —Ç–∞—Ä–µ–ª–∫–∞: –∫—É—Ä–∏—Ü–∞/—Ä—ã–±–∞ 140‚Äì170 –≥ + –∫—Ä—É–ø–∞ (–≥—Ä–µ—á–∫–∞/—Ä–∏—Å) 60‚Äì70 –≥ —Å—É—Ö–æ–π + —Å–∞–ª–∞—Ç 250‚Äì300 –≥`
        },
        snack: {
          kcal: sk,
          text: `–¢–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ + —Ñ—Ä—É–∫—Ç 1 —à—Ç (—è–±–ª–æ–∫–æ/–≥—Ä—É—à–∞) –∏–ª–∏ –π–æ–≥—É—Ä—Ç –Ω–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π 200 –≥`
        },
        dinner: {
          kcal: dk,
          text: `–û–≤–æ—â–∏ 300‚Äì400 –≥ + –±–µ–ª–æ–∫ (—è–π—Ü–∞ 2 —à—Ç / —Ä—ã–±–∞ 140 –≥ / —Ç–≤–æ—Ä–æ–≥ 150 –≥) + 1 —á.–ª. –º–∞—Å–ª–∞`
        }
      };
    }

    function renderMenuPlan(dailyKcal, mode){
      const box = document.getElementById('dayMenuBox');
      const day = buildDayTemplate(dailyKcal);

      if(mode === 'day'){
        box.innerHTML = `
          <b>–ú–µ–Ω—é –Ω–∞ 1 –¥–µ–Ω—å (–ø—Ä–∏–º–µ—Ä)</b><br><br>
          <b>–ó–∞–≤—Ç—Ä–∞–∫ (~${day.breakfast.kcal} –∫–∫–∞–ª):</b> ${day.breakfast.text}<br>
          <b>–û–±–µ–¥ (~${day.lunch.kcal} –∫–∫–∞–ª):</b> ${day.lunch.text}<br>
          <b>–ü–µ—Ä–µ–∫—É—Å (~${day.snack.kcal} –∫–∫–∞–ª):</b> ${day.snack.text}<br>
          <b>–£–∂–∏–Ω (~${day.dinner.kcal} –∫–∫–∞–ª):</b> ${day.dinner.text}<br><br>
          <i>–ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å –∫–∞–∫ –±–∞–∑–æ–≤—ã–π –¥–µ–Ω—å –∏ –º–µ–Ω—è—Ç—å ‚Äú–±–µ–ª–æ–∫/–∫—Ä—É–ø—É/–æ–≤–æ—â–∏‚Äù –º–µ—Å—Ç–∞–º–∏.</i>
        `;
        return;
      }

      // –ù–ï–î–ï–õ–Ø: –º–µ–Ω—è–µ–º –∞–∫—Ü–µ–Ω—Ç—ã, –Ω–æ –¥–µ—Ä–∂–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
      const week = [
        {d:'–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫', note:'–±–∞–ª–∞–Ω—Å –∏ —Å—Ç–∞—Ä—Ç', tweak:'–≤ –æ–±–µ–¥ ‚Äî —Ä—ã–±–∞, –Ω–∞ —É–∂–∏–Ω ‚Äî —è–π—Ü–∞'},
        {d:'–í—Ç–æ—Ä–Ω–∏–∫', note:'–ª—ë–≥–∫–æ—Å—Ç—å', tweak:'–≤ –ø–µ—Ä–µ–∫—É—Å ‚Äî –π–æ–≥—É—Ä—Ç, –≤ —É–∂–∏–Ω ‚Äî —Ç–≤–æ—Ä–æ–≥'},
        {d:'–°—Ä–µ–¥–∞', note:'—ç–Ω–µ—Ä–≥–∏—è', tweak:'–≤ –∑–∞–≤—Ç—Ä–∞–∫ ‚Äî –æ–≤—Å—è–Ω–∫–∞ + —è–≥–æ–¥—ã, –≤ –æ–±–µ–¥ ‚Äî –∫—É—Ä–∏—Ü–∞'},
        {d:'–ß–µ—Ç–≤–µ—Ä–≥', note:'–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ', tweak:'–≤ –æ–±–µ–¥ ‚Äî —Å—É–ø + —Å–∞–ª–∞—Ç, –≤ —É–∂–∏–Ω ‚Äî —Ä—ã–±–∞'},
        {d:'–ü—è—Ç–Ω–∏—Ü–∞', note:'–ø–æ–¥–¥–µ—Ä–∂–∫–∞', tweak:'–≤ –ø–µ—Ä–µ–∫—É—Å ‚Äî —Ç–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç, –≤ —É–∂–∏–Ω ‚Äî –æ–º–ª–µ—Ç'},
        {d:'–°—É–±–±–æ—Ç–∞', note:'–π–æ–≥–∞-–¥–µ–Ω—å', tweak:'—á—É—Ç—å –±–æ–ª—å—à–µ –æ–≤–æ—â–µ–π, –ø–æ–º–µ–Ω—å—à–µ —Å–ª–∞–¥–∫–æ–≥–æ'},
        {d:'–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ', note:'–º—è–≥–∫–æ –∏ –ø—Ä–æ—Å—Ç–æ', tweak:'–ø–æ–≤—Ç–æ—Ä –ª—é–±–∏–º–æ–≥–æ –¥–Ω—è –Ω–µ–¥–µ–ª–∏'},
      ];

      const lines = week.map(w=>{
        return `
          <b>${w.d}</b> ‚Äî <span style="color:#5f6b63">${w.note}</span><br>
          ‚Ä¢ –ó–∞–≤—Ç—Ä–∞–∫ (~${day.breakfast.kcal} –∫–∫–∞–ª): ${day.breakfast.text}<br>
          ‚Ä¢ –û–±–µ–¥ (~${day.lunch.kcal} –∫–∫–∞–ª): ${day.lunch.text}<br>
          ‚Ä¢ –ü–µ—Ä–µ–∫—É—Å (~${day.snack.kcal} –∫–∫–∞–ª): ${day.snack.text}<br>
          ‚Ä¢ –£–∂–∏–Ω (~${day.dinner.kcal} –∫–∫–∞–ª): ${day.dinner.text}<br>
          <i>–ü–æ–¥—Å–∫–∞–∑–∫–∞ –¥–Ω—è:</i> ${w.tweak}<br>
          <div style="height:10px"></div>
        `;
      }).join('');

      box.innerHTML = `
        <b>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ + –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)</b><br>
        <div class="smallNote">–°—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å: ~${dailyKcal} –∫–∫–∞–ª. –ú–µ–Ω—è–µ–º ‚Äú–±–µ–ª–æ–∫/–≥–∞—Ä–Ω–∏—Ä/–æ–≤–æ—â–∏‚Äù, –Ω–µ –ª–æ–º–∞—è —Å–∏—Å—Ç–µ–º—É.</div>
        <div style="margin-top:10px">${lines}</div>
      `;
    }

    // --- –£–ú–ù–û–ï –ú–ï–ù–Æ –ò–ó –ü–†–û–î–£–ö–¢–û–í ---
    function normalizeList(str){
      return str.split(',')
        .map(s=>s.trim().toLowerCase())
        .filter(Boolean)
        .slice(0, 30);
    }

    function smartMenuFromList(list){
      const has = (key)=> list.some(x=>x.includes(key));

      const pick = (arr)=> arr.find(Boolean) || arr[arr.length-1];

      const breakfast = pick([
        has('–æ–≤—Å—è') && '–û–≤—Å—è–Ω–∫–∞ 60 –≥ —Å—É—Ö–æ–π + —è–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç—ã + 1‚Äì2 —è–π—Ü–∞',
        (has('—Ç–≤–æ—Ä') || has('–π–æ–≥—É—Ä')) && '–¢–≤–æ—Ä–æ–≥ 200 –≥ / –π–æ–≥—É—Ä—Ç 200 –≥ + —Ñ—Ä—É–∫—Ç',
        has('—è–π—Ü') && '–û–º–ª–µ—Ç 2 —è–π—Ü–∞ + –æ–≤–æ—â–∏',
        '–ö–∞—à–∞/–π–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç (–ø–æ –Ω–∞–ª–∏—á–∏—é)'
      ]);

      const lunch = pick([
        (has('–∫—É—Ä') || has('–∏–Ω–¥–µ–π')) && '–ö—É—Ä–∏—Ü–∞/–∏–Ω–¥–µ–π–∫–∞ 150 –≥ + —Å–∞–ª–∞—Ç 300 –≥ + –∫—Ä—É–ø–∞ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)',
        has('—Ä—ã–±') && '–†—ã–±–∞ 150 –≥ + –æ–≤–æ—â–∏ 350 –≥ + –Ω–µ–º–Ω–æ–≥–æ –º–∞—Å–ª–∞',
        has('–≥—Ä–µ—á') && '–ì—Ä–µ—á–∫–∞ + –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫ (—è–π—Ü–∞/—Ç–≤–æ—Ä–æ–≥/—Ä—ã–±–∞)',
        '–¢—ë–ø–ª–∞—è —Ç–∞—Ä–µ–ª–∫–∞: –±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + —á—É—Ç—å –∫—Ä—É–ø—ã'
      ]);

      const snack = pick([
        has('—Ç–≤–æ—Ä') && '–¢–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ + —Ñ—Ä—É–∫—Ç',
        has('–π–æ–≥—É—Ä') && '–ô–æ–≥—É—Ä—Ç 200 –≥ + –æ—Ä–µ—Ö–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)',
        '–§—Ä—É–∫—Ç + —Å—Ç–∞–∫–∞–Ω –≤–æ–¥—ã'
      ]);

      const dinner = pick([
        has('–æ–≤–æ—â') && '–û–≤–æ—â–∏ 350‚Äì450 –≥ + –±–µ–ª–æ–∫ (—è–π—Ü–∞/—Ä—ã–±–∞/—Ç–≤–æ—Ä–æ–≥)',
        has('—è–π—Ü') && '–û–º–ª–µ—Ç 2 —è–π—Ü–∞ + —Å–∞–ª–∞—Ç',
        '–õ—ë–≥–∫–∏–π —É–∂–∏–Ω: –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫'
      ]);

      return {breakfast, lunch, snack, dinner};
    }

    function renderSmartMenu(title, menuObj){
      const box = document.getElementById('smartMenuBox');
      box.style.display = 'block';
      box.innerHTML = `
        <b>${title}</b><br><br>
        <b>–ó–∞–≤—Ç—Ä–∞–∫:</b> ${menuObj.breakfast}<br>
        <b>–û–±–µ–¥:</b> ${menuObj.lunch}<br>
        <b>–ü–µ—Ä–µ–∫—É—Å:</b> ${menuObj.snack}<br>
        <b>–£–∂–∏–Ω:</b> ${menuObj.dinner}<br><br>
        <i>–ú–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–∞–∫ ‚Äú–±–∞–∑–æ–≤—ã–π –¥–µ–Ω—å‚Äù –∏ –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã.</i>
      `;
    }

    function handleMenuFromText(){
      const raw = document.getElementById('products').value.trim();
      if(!raw){
        alert('–ù–∞–ø–∏—à–∏ –ø—Ä–æ–¥—É–∫—Ç—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é üôÇ');
        return;
      }
      const list = normalizeList(raw);
      const m = smartMenuFromList(list);
      renderSmartMenu('–ú–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å (–ø–æ —Å–ø–∏—Å–∫—É)', m);
    }

    // –ò–º–∏—Ç–∞—Ü–∏—è ‚ÄúAI –ø–æ–Ω—è–ª —Ñ–æ—Ç–æ‚Äù
    function handleMenuFromPhoto(){
      const file = document.getElementById('photo').files[0];
      if(!file){
        alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ñ–æ—Ç–æ üôÇ');
        return;
      }

      // –∏–º–∏—Ç–∏—Ä—É–µ–º ‚Äú–∞–Ω–∞–ª–∏–∑‚Äù
      const demoSets = [
        ['—è–π—Ü–∞','—Ç–≤–æ—Ä–æ–≥','–æ–≤—Å—è–Ω–∫–∞','–æ–≤–æ—â–∏','—è–±–ª–æ–∫–∏'],
        ['–∫—É—Ä–∏—Ü–∞','—Ä–∏—Å','–æ–≤–æ—â–∏','–π–æ–≥—É—Ä—Ç','–±–∞–Ω–∞–Ω—ã'],
        ['—Ä—ã–±–∞','–≥—Ä–µ—á–∫–∞','–æ–≤–æ—â–∏','—Ç–≤–æ—Ä–æ–≥','—è–≥–æ–¥—ã'],
      ];
      const picked = demoSets[Math.floor(Math.random()*demoSets.length)];
      const m = smartMenuFromList(picked);

      renderSmartMenu(
        `–ú–µ–Ω—é –ø–æ —Ñ–æ—Ç–æ (–≤–∞—É-–¥–µ–º–æ): ‚Äú—è —Ä–∞—Å–ø–æ–∑–Ω–∞–ª(–∞)‚Äù ‚Üí ${picked.join(', ')}`,
        m
      );
    }

    // --- –ù–ê–í–ï–°–ö–ê –°–û–ë–´–¢–ò–ô (—á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ —Ç–æ—á–Ω–æ —Ä–∞–±–æ—Ç–∞–ª–∞ –≤—Å–µ–≥–¥–∞) ---
    document.addEventListener('DOMContentLoaded', ()=>{
      // –∫–Ω–æ–ø–∫–∞ —Ä–∞—Å—Å—á—ë—Ç–∞
      document.getElementById('calcBtn').addEventListener('click', calcAndRender);

      // –≤–∫–ª–∞–¥–∫–∏ –º–µ–Ω—é
      document.getElementById('tabDay').addEventListener('click', ()=>{
        const daily = Number(document.getElementById('dailyKcal').textContent || 0);
        if(!daily){ alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ‚Äú–†–∞—Å—Å—á–∏—Ç–∞—Ç—å‚Äù üôÇ'); return; }
        setActiveTab('day');
        renderMenuPlan(daily, 'day');
      });
      document.getElementById('tabWeek').addEventListener('click', ()=>{
        const daily = Number(document.getElementById('dailyKcal').textContent || 0);
        if(!daily){ alert('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏ ‚Äú–†–∞—Å—Å—á–∏—Ç–∞—Ç—å‚Äù üôÇ'); return; }
        setActiveTab('week');
        renderMenuPlan(daily, 'week');
      });

      // —É–º–Ω–æ–µ –º–µ–Ω—é
      document.getElementById('menuFromTextBtn').addEventListener('click', handleMenuFromText);
      document.getElementById('menuFromPhotoBtn').addEventListener('click', handleMenuFromPhoto);
    });
  </script>
</body>
</html>
