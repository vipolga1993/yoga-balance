<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ ‚Äî –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –π–æ–≥–∏</title>

  <style>
    :root{
      --bg: #f6faf7;
      --card: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --line: #e7efe9;

      --green: #6fbf8a;
      --green2:#2f6f4e;
      --greenSoft:#e9f6ee;

      --shadow: 0 12px 30px rgba(0,0,0,.06);
      --r: 18px;
      --r2: 14px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 520px at 15% 0%, #eaf8f0 0%, transparent 60%),
        radial-gradient(900px 520px at 95% 10%, #eef5ff 0%, transparent 58%),
        var(--bg);
    }
    .wrap{
      max-width: 1040px;
      margin: 0 auto;
      padding: 22px 16px 60px;
    }

    /* Header */
    .header{
      display:flex;
      gap:14px;
      align-items:flex-start;
      margin: 10px 0 18px;
    }
    .logo{
      width:48px;height:48px;
      border-radius: 16px;
      display:grid;place-items:center;
      background: linear-gradient(145deg, #dff3e7, #f8fff9);
      border: 1px solid rgba(0,0,0,.03);
      box-shadow: var(--shadow);
      font-size:22px;
      flex: 0 0 auto;
    }
    h1{
      margin:0;
      font-size: 34px;
      letter-spacing: -.3px;
      color: #2f4f3f;
      line-height: 1.15;
    }
    .subtitle{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 15px;
      line-height: 1.55;
      max-width: 840px;
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 16px;
      margin-top: 16px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }

    /* Cards */
    .card{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.04);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .card h2{
      margin: 0 0 10px;
      font-size: 22px;
      letter-spacing: -.2px;
    }
    .hint{
      margin: 0 0 14px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
    }

    /* Form */
    .form{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin-top: 12px;
    }
    @media (max-width: 720px){
      .form{ grid-template-columns: 1fr; }
    }
    label{
      display:block;
      font-size: 13px;
      color: var(--muted);
      margin: 0 0 6px;
    }
    input, select, textarea{
      width: 100%;
      padding: 12px 12px;
      border-radius: var(--r2);
      border: 1px solid #e6e6e6;
      background: #fbfbfb;
      outline: none;
      font-size: 16px;
    }
    textarea{
      min-height: 96px;
      resize: vertical;
    }
    input:focus, select:focus, textarea:focus{
      border-color: #bfe8cf;
      box-shadow: 0 0 0 4px rgba(111,191,138,.16);
      background:#fff;
    }

    /* Buttons */
    .btn{
      width: 100%;
      border: none;
      border-radius: 16px;
      padding: 15px 14px;
      font-size: 17px;
      font-weight: 800;
      cursor: pointer;
      background: var(--green);
      color: #fff;
      transition: transform .05s ease, filter .2s ease;
      margin-top: 14px;
    }
    .btn:hover{ filter: brightness(.98); }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      background: var(--greenSoft);
      color: var(--green2);
      border: 1px solid #dfeee6;
      font-weight: 800;
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .btnRow .btn{
      margin-top:0;
      width: auto;
      padding: 12px 14px;
      border-radius: 999px;
      font-size: 15px;
    }

    /* Small UI */
    .pill{
      display:inline-flex;
      gap: 8px;
      align-items:center;
      padding: 8px 12px;
      border-radius: 999px;
      background: var(--greenSoft);
      color: var(--green2);
      font-size: 13px;
      font-weight: 800;
      margin-top: 10px;
    }
    .divider{
      height: 1px;
      background: var(--line);
      margin: 14px 0;
    }

    /* Results */
    .resultWrap{ display:none; margin-top: 14px; }
    .statCard{
      background: #f7fbf8;
      border: 1px solid #dff1e7;
      border-radius: 16px;
      padding: 14px;
    }
    .big{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      align-items: baseline;
    }
    .kcal{
      font-size: 28px;
      font-weight: 900;
      color: var(--green2);
    }
    .muted{
      color: var(--muted);
      font-size: 14px;
      line-height: 1.55;
      margin-top: 6px;
    }

    .mealGrid{
      list-style:none;
      padding:0;
      margin: 12px 0 0;
      display:grid;
      gap: 10px;
    }
    .mealItem{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 12px;
      border-radius: 14px;
      background:#fff;
      border: 1px solid #e9f3ee;
    }
    .mealIcon{
      width: 36px;
      height: 36px;
      border-radius: 14px;
      background: var(--greenSoft);
      display:grid;
      place-items:center;
      font-size: 18px;
      flex: 0 0 auto;
    }
    .mealTitle{
      font-weight: 900;
      margin-bottom: 3px;
    }
    .mealSub{
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .tabs{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    .tabBtn{
      border: 1px solid #dfeee6;
      background: #fff;
      color: #2f4f3f;
      border-radius: 999px;
      padding: 10px 14px;
      font-weight: 900;
      cursor: pointer;
    }
    .tabBtn.active{
      background: var(--greenSoft);
      border-color: #bfe8cf;
      color: var(--green2);
    }

    .menuBox{ display:none; margin-top: 12px; }
    .dayCard{
      background:#fff;
      border: 1px solid #e8f3ec;
      border-radius: 16px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .dayCard h3{
      margin:0 0 6px;
      font-size: 16px;
      letter-spacing: -.2px;
    }
    .dayHint{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .lines{
      margin:0;
      padding-left: 18px;
      display:grid;
      gap: 8px;
      line-height: 1.45;
    }
    .mini{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    /* Smart menu */
    .smartOut{ display:none; margin-top: 12px; }
    .note{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.5;
    }
    .warn{
      display:none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      background:#fff7ed;
      border:1px solid #fed7aa;
      color:#9a3412;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Footer note */
    .footer{
      margin-top: 14px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.55;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <div class="logo">ü•ó</div>
      <div>
        <h1>–ú–µ–Ω—é –∏–∑ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞</h1>
        <p class="subtitle">
          –ú—è–≥–∫–æ–µ –ø–∏—Ç–∞–Ω–∏–µ –¥–ª—è –∂–µ–Ω—â–∏–Ω, –ø—Ä–∞–∫—Ç–∏–∫—É—é—â–∏—Ö –π–æ–≥—É –∏ –≤—ã–±–∏—Ä–∞—é—â–∏—Ö –±–µ—Ä–µ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ç–µ–ª—É.
          –ë–µ–∑ –¥–∏–µ—Ç, –∑–∞–ø—Ä–µ—Ç–æ–≤ –∏ –¥–∞–≤–ª–µ–Ω–∏—è ‚Äî —Å –æ–ø–æ—Ä–æ–π –Ω–∞ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ, —ç–Ω–µ—Ä–≥–∏—é –∏ —Ä–µ–∞–ª—å–Ω—É—é –∂–∏–∑–Ω—å.
        </p>
      </div>
    </div>

    <div class="grid">
      <!-- LEFT: Calculation + Menu -->
      <div class="card">
        <h2>–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç</h2>
        <p class="hint">
          –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã ‚Äî —è –ø–æ–¥—Å–∫–∞–∂—É –æ—Ä–∏–µ–Ω—Ç–∏—Ä –ø–æ —ç–Ω–µ—Ä–≥–∏–∏ –∏ –ø–æ–∫–∞–∂—É, –∫–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è –º—è–≥–∫–æ –∏ —É—Å—Ç–æ–π—á–∏–≤–æ.
        </p>

        <div class="form">
          <div>
            <label for="weight">–í–µ—Å (–∫–≥)</label>
            <input id="weight" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 72">
          </div>
          <div>
            <label for="height">–†–æ—Å—Ç (—Å–º)</label>
            <input id="height" type="number" inputmode="decimal" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 168">
          </div>
          <div>
            <label for="age">–í–æ–∑—Ä–∞—Å—Ç</label>
            <input id="age" type="number" inputmode="numeric" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 36">
          </div>
          <div>
            <label for="gender">–ü–æ–ª</label>
            <select id="gender">
              <option value="female" selected>–ñ–µ–Ω—Å–∫–∏–π</option>
              <option value="male">–ú—É–∂—Å–∫–æ–π</option>
            </select>
          </div>
          <div>
            <label for="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</label>
            <select id="activity">
              <option value="1.2">–ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –æ—Ñ–∏—Å, –¥–æ—Ä–æ–≥–∞, –º–∞–ª–æ –¥–≤–∏–∂–µ–Ω–∏—è</option>
              <option value="1.35">–£–º–µ—Ä–µ–Ω–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –ø—Ä–æ–≥—É–ª–∫–∏ –∏ –±—ã—Ç–æ–≤–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ</option>
              <option value="1.45">–ô–æ–≥–∞ 1‚Äì2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é ‚Äî –º—è–≥–∫–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
              <option value="1.55">–ô–æ–≥–∞ 2‚Äì3 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é ‚Äî —Ä–µ–≥—É–ª—è—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞</option>
              <option value="1.7">–ô–æ–≥–∞ 3+ —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é / –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∏—Ç–º</option>
            </select>
          </div>
          <div>
            <label for="goal">–¶–µ–ª—å</label>
            <select id="goal">
              <option value="0.90" selected>–ú—è–≥–∫–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞</option>
              <option value="1.00">–ë–∞–ª–∞–Ω—Å –∏ —ç–Ω–µ—Ä–≥–∏—è</option>
              <option value="1.05">–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º—ã</option>
            </select>
          </div>
        </div>

        <div class="pill">üåø –ù–µ–∂–Ω—ã–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä, –∞ –Ω–µ –∂—ë—Å—Ç–∫–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å</div>

        <button class="btn" id="calcBtn" type="button">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å</button>
        <div class="warn" id="warnCalc">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å, —Ä–æ—Å—Ç –∏ –≤–æ–∑—Ä–∞—Å—Ç (—á–∏—Å–ª–∞–º–∏), –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.</div>

        <div class="resultWrap" id="resultWrap">
          <div class="statCard">
            <div class="big">
              <div><b>–í–∞—à–∞ —Å—É—Ç–æ—á–Ω–∞—è –Ω–æ—Ä–º–∞ —ç–Ω–µ—Ä–≥–∏–∏:</b></div>
              <div class="kcal" id="dailyKcal">‚Äî</div>
              <div>–∫–∫–∞–ª</div>
            </div>
            <div class="muted" id="bjuText">–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: ‚Äî</div>

            <div class="divider"></div>

            <b>–ö–∞–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è</b>
            <div class="muted">–ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ—Ç–æ—Ä—É—é –ª–µ–≥–∫–æ –ø–æ–¥—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–¥ —Å–µ–±—è.</div>

            <ul class="mealGrid" id="mealSplit"></ul>

            <div class="muted" id="toneLine">–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –π–æ–≥–∏, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∏ –º—è–≥–∫–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –∫ —Ü–µ–ª–∏.</div>

            <div class="tabs">
              <button class="tabBtn active" id="tabDay" type="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä –Ω–∞ –¥–µ–Ω—å</button>
              <button class="tabBtn" id="tabWeek" type="button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</button>
            </div>

            <div class="menuBox" id="dayBox"></div>
            <div class="menuBox" id="weekBox"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Smart Menu -->
      <div class="card">
        <h2>–£–º–Ω–æ–µ –º–µ–Ω—é –∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h2>
        <p class="hint">
          –Ø –ø–æ–º–æ–≥—É —Å–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å —É –≤–∞—Å –¥–æ–º–∞.
          –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ <b>–∏–ª–∏</b> –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –≤—Ä—É—á–Ω—É—é ‚Äî –∫–∞–∫ –≤–∞–º —É–¥–æ–±–Ω–µ–µ ü§ç
        </p>

        <label for="fridgePhoto">–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫–∞ –∏–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</label>
        <input id="fridgePhoto" type="file" accept="image/*">

        <div class="btnRow">
          <button class="btn secondary" id="fillFromPhotoBtn" type="button">–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ</button>
        </div>

        <div class="divider"></div>

        <label for="products">–ü—Ä–æ–¥—É–∫—Ç—ã (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
        <textarea id="products" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: —è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, –æ–≤–æ—â–∏, –∫—É—Ä–∏—Ü–∞"></textarea>

        <button class="btn" id="smartMenuBtn" type="button">–°–æ—Å—Ç–∞–≤–∏—Ç—å –º–µ–Ω—é</button>

        <div class="warn" id="warnSmart">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª).</div>

        <div class="smartOut" id="smartOut"></div>

        <div class="footer">
          –≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ –ø–∏—Ç–∞–Ω–∏–∏ –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞.
        </div>
      </div>
    </div>
  </div>

  <script>
    // Helpers
    const $ = (id) => document.getElementById(id);

    function parseNum(v){
      const s = String(v ?? "").replace(",", ".").trim();
      const n = Number(s);
      return Number.isFinite(n) ? n : NaN;
    }
    function round(n){ return Math.round(n); }
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function kcalSplit(total){
      const breakfast = round(total * 0.30);
      const lunch     = round(total * 0.35);
      const snack     = round(total * 0.15);
      const dinner    = total - breakfast - lunch - snack;
      return { breakfast, lunch, snack, dinner };
    }

    function safeText(s){
      return String(s).replace(/[<>&"]/g, c => ({ "<":"&lt;", ">":"&gt;", "&":"&amp;", '"':"&quot;" }[c]));
    }

    // Calculation (Mifflin-St Jeor)
    function calculate(){
      const w = parseNum($("weight").value);
      const h = parseNum($("height").value);
      const a = parseNum($("age").value);

      $("warnCalc").style.display = "none";

      if(!Number.isFinite(w) || !Number.isFinite(h) || !Number.isFinite(a) || w<=0 || h<=0 || a<=0){
        $("warnCalc").style.display = "block";
        $("resultWrap").style.display = "none";
        return null;
      }

      const g = $("gender").value;
      const act  = parseNum($("activity").value);
      const goal = parseNum($("goal").value);

      const bmr = (g === "male")
        ? (10*w + 6.25*h - 5*a + 5)
        : (10*w + 6.25*h - 5*a - 161);

      let cal = round(bmr * act * goal);
      cal = clamp(cal, 1200, 3000);

      // Macros - gentle guideline
      const p = round(w * 1.3);
      const f = round(w * 0.9);
      const c = Math.max(0, round((cal - (p*4 + f*9)) / 4));

      return { cal, p, f, c };
    }

    function toneByGoal(){
      const goal = parseNum($("goal").value);
      if(goal <= 0.91) return "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –π–æ–≥–∏ –∏ –º—è–≥–∫–æ–≥–æ —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞ –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è.";
      if(goal < 1.03)  return "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Ä–æ–≤–Ω–æ–≥–æ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è.";
      return "–ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ñ–æ—Ä–º—ã –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.";
    }

    function renderResults(model){
      const { cal, p, f, c } = model;

      $("dailyKcal").textContent = String(cal);
      $("bjuText").textContent = `–û—Ä–∏–µ–Ω—Ç–∏—Ä –ë–ñ–£: –±–µ–ª–∫–∏ ${p} –≥ ‚Ä¢ –∂–∏—Ä—ã ${f} –≥ ‚Ä¢ —É–≥–ª–µ–≤–æ–¥—ã ${c} –≥`;
      $("toneLine").textContent = toneByGoal();

      const split = kcalSplit(cal);
      const items = [
        { icon:"ü´ê", title:"–ó–∞–≤—Ç—Ä–∞–∫", pct:"–æ–∫–æ–ª–æ 30%", kcal: split.breakfast },
        { icon:"üç≤", title:"–û–±–µ–¥",     pct:"–æ–∫–æ–ª–æ 35%", kcal: split.lunch },
        { icon:"üçè", title:"–ü–µ—Ä–µ–∫—É—Å",  pct:"–æ–∫–æ–ª–æ 15%", kcal: split.snack },
        { icon:"ü•ó", title:"–£–∂–∏–Ω",     pct:"–æ–∫–æ–ª–æ 20%", kcal: split.dinner },
      ];

      $("mealSplit").innerHTML = items.map(x => `
        <li class="mealItem">
          <div class="mealIcon">${x.icon}</div>
          <div>
            <div class="mealTitle">${safeText(x.title)} ‚Äî ${safeText(x.pct)} (${x.kcal} –∫–∫–∞–ª)</div>
            <div class="mealSub">–≠—Ç–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä: –≤—ã –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É.</div>
          </div>
        </li>
      `).join("");

      renderDayMenu(cal);
      renderWeekMenu(cal);

      $("resultWrap").style.display = "block";
      showTab("day");
    }

    function showTab(which){
      const dayBtn = $("tabDay");
      const weekBtn = $("tabWeek");
      const dayBox = $("dayBox");
      const weekBox = $("weekBox");

      if(which === "day"){
        dayBtn.classList.add("active");
        weekBtn.classList.remove("active");
        dayBox.style.display = "block";
        weekBox.style.display = "none";
      } else {
        weekBtn.classList.add("active");
        dayBtn.classList.remove("active");
        weekBox.style.display = "block";
        dayBox.style.display = "none";
      }
    }

    function renderDayMenu(totalKcal){
      const s = kcalSplit(totalKcal);

      const blocks = [
        {
          title: `ü´ê –ó–∞–≤—Ç—Ä–∞–∫ ‚âà ${s.breakfast} –∫–∫–∞–ª`,
          hint:  "–¢—ë–ø–ª—ã–π –∏ —Å—ã—Ç–Ω—ã–π ‚Äî —á—Ç–æ–±—ã –Ω–µ —Ç—è–Ω—É—Ç—å—Å—è –∫ —Å–ª–∞–¥–∫–æ–º—É —á–µ—Ä–µ–∑ —á–∞—Å.",
          lines: [
            "–û–≤—Å—è–Ω—ã–µ —Ö–ª–æ–ø—å—è (—Å—É—Ö–∏–µ) ‚Äî 60 –≥",
            "–Ø–≥–æ–¥—ã ‚Äî 100 –≥",
            "–Ø–π—Ü–æ ‚Äî 1‚Äì2 —à—Ç (–ø–æ –≥–æ–ª–æ–¥—É)",
            "–û—Ä–µ—Ö–∏ ‚Äî 10 –≥ (–ø–æ –∂–µ–ª–∞–Ω–∏—é)"
          ]
        },
        {
          title: `üç≤ –û–±–µ–¥ ‚âà ${s.lunch} –∫–∫–∞–ª`,
          hint:  "–û—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–∏—ë–º –ø–∏—â–∏ –¥–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏.",
          lines: [
            "–ö—É—Ä–∏—Ü–∞/—Ä—ã–±–∞ ‚Äî 140‚Äì170 –≥",
            "–ì—Ä–µ—á–∫–∞/—Ä–∏—Å (—Å—É—Ö–∏–µ) ‚Äî 60‚Äì70 –≥",
            "–û–≤–æ—â–∏/—Å–∞–ª–∞—Ç ‚Äî 250‚Äì300 –≥",
            "–û–ª–∏–≤–∫–æ–≤–æ–µ –º–∞—Å–ª–æ ‚Äî 1 —á.–ª."
          ]
        },
        {
          title: `üçè –ü–µ—Ä–µ–∫—É—Å ‚âà ${s.snack} –∫–∫–∞–ª`,
          hint:  "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑ —Ä–µ–∑–∫–∏—Ö —Å–∫–∞—á–∫–æ–≤ –∏ —á—É–≤—Å—Ç–≤–∞ –≥–æ–ª–æ–¥–∞.",
          lines: [
            "–¢–≤–æ—Ä–æ–≥ 5% ‚Äî 180‚Äì220 –≥",
            "–§—Ä—É–∫—Ç ‚Äî 1 —à—Ç",
            "–í–æ–¥–∞ ‚Äî 1 —Å—Ç–∞–∫–∞–Ω"
          ]
        },
        {
          title: `ü•ó –£–∂–∏–Ω ‚âà ${s.dinner} –∫–∫–∞–ª`,
          hint:  "–õ—ë–≥–∫–∏–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ—Å–ª–µ –ø—Ä–∞–∫—Ç–∏–∫–∏.",
          lines: [
            "–û–≤–æ—â–∏ ‚Äî 300‚Äì400 –≥",
            "–ë–µ–ª–æ–∫ (—è–π—Ü–∞/—Ä—ã–±–∞/—Ç–≤–æ—Ä–æ–≥) ‚Äî 1 –≤–∞—Ä–∏–∞–Ω—Ç",
            "–ï—Å–ª–∏ —Ö–æ—á–µ—Ç—Å—è ‚Äî –≥–∞—Ä–Ω–∏—Ä –º–∞–ª–µ–Ω—å–∫–æ–π –ø–æ—Ä—Ü–∏–µ–π"
          ]
        }
      ];

      $("dayBox").innerHTML = `
        <div class="dayCard">
          <h3>–ü—Ä–∏–º–µ—Ä –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å</h3>
          <p class="dayHint">–≠—Ç–æ –≥–∏–±–∫–∏–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä: –º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É ¬´–±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + —É–º–µ—Ä–µ–Ω–Ω–æ –≥–∞—Ä–Ω–∏—Ä¬ª.</p>
        </div>
        ${blocks.map(b => `
          <div class="dayCard">
            <h3>${safeText(b.title)}</h3>
            <p class="dayHint">${safeText(b.hint)}</p>
            <ul class="lines">
              ${b.lines.map(x => `<li>${safeText(x)}</li>`).join("")}
            </ul>
          </div>
        `).join("")}
        <div class="dayCard">
          <div class="pill">‚ú® –ï—Å–ª–∏ –µ—Å—Ç—å —É—Å—Ç–∞–ª–æ—Å—Ç—å ‚Äî –¥–æ–±–∞–≤—å—Ç–µ –≤–æ–¥—ã –∏ –æ–≤–æ—â–µ–π, –∞ —É–∂–∏–Ω —Å–¥–µ–ª–∞–π—Ç–µ –ª–µ–≥—á–µ.</div>
        </div>
      `;
    }

    function renderWeekMenu(totalKcal){
      const s = kcalSplit(totalKcal);

      const breakfast = [
        "–û–≤—Å—è–Ω–∫–∞ 60 –≥ + —è–≥–æ–¥—ã 100 –≥ + —è–π—Ü–æ 1‚Äì2 —à—Ç",
        "–¢–≤–æ—Ä–æ–≥ 200 –≥ + —Ñ—Ä—É–∫—Ç 1 —à—Ç + –æ—Ä–µ—Ö–∏ 10 –≥",
        "–û–º–ª–µ—Ç 2 —è–π—Ü–∞ + –æ–≤–æ—â–∏ 250 –≥",
        "–ô–æ–≥—É—Ä—Ç 250 –≥ + —Ñ—Ä—É–∫—Ç—ã + –Ω–µ–º–Ω–æ–≥–æ –æ—Ä–µ—Ö–æ–≤"
      ];
      const lunch = [
        "–ö—É—Ä–∏—Ü–∞ 150 –≥ + –≥—Ä–µ—á–∫–∞ 60‚Äì70 –≥ (—Å—É—Ö–∞—è) + —Å–∞–ª–∞—Ç 300 –≥",
        "–†—ã–±–∞ 170 –≥ + —Ä–∏—Å 60 –≥ (—Å—É—Ö–∞—è) + –æ–≤–æ—â–∏ 300 –≥",
        "–ò–Ω–¥–µ–π–∫–∞ 150 –≥ + –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å 250 –≥ + –æ–≤–æ—â–∏ 250 –≥",
        "–ß–µ—á–µ–≤–∏—Ü–∞/—Ñ–∞—Å–æ–ª—å 200 –≥ + –æ–≤–æ—â–∏ 300 –≥ + –º–∞—Å–ª–æ 1 —á.–ª."
      ];
      const snack = [
        "–¢–≤–æ—Ä–æ–≥ 180‚Äì220 –≥ + —Ñ—Ä—É–∫—Ç",
        "–ô–æ–≥—É—Ä—Ç 200‚Äì250 –≥ + —è–≥–æ–¥—ã",
        "–§—Ä—É–∫—Ç + –æ—Ä–µ—Ö–∏ 15 –≥",
        "–ö–µ—Ñ–∏—Ä/—Ä—è–∂–µ–Ω–∫–∞ 250 –º–ª"
      ];
      const dinner = [
        "–û–≤–æ—â–∏ 350 –≥ + —Ä—ã–±–∞ 140 –≥",
        "–û–≤–æ—â–∏ 350 –≥ + —è–π—Ü–∞ 2 —à—Ç",
        "–û–≤–æ—â–∏ 350 –≥ + —Ç–≤–æ—Ä–æ–≥ 150 –≥",
        "–û–≤–æ—â–∏ 350 –≥ + –∫—É—Ä–∏—Ü–∞ 120‚Äì140 –≥"
      ];

      const days = [
        { name:"–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", vibe:"–±–∞–ª–∞–Ω—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π" },
        { name:"–í—Ç–æ—Ä–Ω–∏–∫", vibe:"–ª—ë–≥–∫–æ—Å—Ç—å" },
        { name:"–°—Ä–µ–¥–∞", vibe:"—Å—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è" },
        { name:"–ß–µ—Ç–≤–µ—Ä–≥", vibe:"–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ" },
        { name:"–ü—è—Ç–Ω–∏—Ü–∞", vibe:"—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å" },
        { name:"–°—É–±–±–æ—Ç–∞", vibe:"–≥–∏–±–∫–æ—Å—Ç—å" },
        { name:"–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ", vibe:"–º—è–≥–∫–∏–π –¥–µ–Ω—å" }
      ];

      const pick = (arr, i) => arr[i % arr.length];

      $("weekBox").innerHTML = `
        <div class="dayCard">
          <h3>–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é</h3>
          <p class="dayHint">–°—É—Ç–æ—á–Ω–∞—è —Ü–µ–ª—å: ‚âà ${totalKcal} –∫–∫–∞–ª. –ú–µ–Ω—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É ‚Äî —Ç–∞–∫ –ª–µ–≥—á–µ –¥–µ—Ä–∂–∞—Ç—å –±–∞–ª–∞–Ω—Å.</p>
          <div class="mini">–ö–∞–ª–æ—Ä–∏–∏ –ø–æ –ø—Ä–∏—ë–º–∞–º –ø–∏—â–∏: –∑–∞–≤—Ç—Ä–∞–∫ ~${s.breakfast}, –æ–±–µ–¥ ~${s.lunch}, –ø–µ—Ä–µ–∫—É—Å ~${s.snack}, —É–∂–∏–Ω ~${s.dinner} –∫–∫–∞–ª.</div>
        </div>

        ${days.map((d, i) => `
          <div class="dayCard">
            <h3>${safeText(d.name)} ‚Äî ${safeText(d.vibe)}</h3>
            <ul class="lines">
              <li><b>ü´ê –ó–∞–≤—Ç—Ä–∞–∫ (~${s.breakfast} –∫–∫–∞–ª):</b> ${safeText(pick(breakfast, i))}</li>
              <li><b>üç≤ –û–±–µ–¥ (~${s.lunch} –∫–∫–∞–ª):</b> ${safeText(pick(lunch, i))}</li>
              <li><b>üçè –ü–µ—Ä–µ–∫—É—Å (~${s.snack} –∫–∫–∞–ª):</b> ${safeText(pick(snack, i))}</li>
              <li><b>ü•ó –£–∂–∏–Ω (~${s.dinner} –∫–∫–∞–ª):</b> ${safeText(pick(dinner, i))}</li>
            </ul>
            <div class="mini">–ü–æ–¥—Å–∫–∞–∑–∫–∞: –æ–≤–æ—â–∏ –≤ –∫–∞–∂–¥–æ–º –ø—Ä–∏—ë–º–µ –¥–∞—é—Ç —Å—ã—Ç–æ—Å—Ç—å –∏ –ø–æ–º–æ–≥–∞—é—Ç –¥–µ—Ä–∂–∞—Ç—å –∫—É—Ä—Å –º—è–≥–∫–æ.</div>
          </div>
        `).join("")}

        <div class="dayCard">
          <div class="pill">‚ú® –≠—Ç—É –Ω–µ–¥–µ–ª—é –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä—è—Ç—å 3‚Äì4 —Ä–∞–∑–∞ ‚Äî –ø–æ–ª—É—á–∏—Ç—Å—è –º–µ—Å—è—Ü –±–µ–∑ –ø–µ—Ä–µ–≥—Ä—É–∑–∞.</div>
        </div>
      `;
    }

    // Smart menu logic
    const photoSets = [
      "—è–π—Ü–∞, —Ç–≤–æ—Ä–æ–≥, –æ–≤—Å—è–Ω–∫–∞, –æ–≤–æ—â–∏, —è–±–ª–æ–∫–∏",
      "–∫—É—Ä–∏—Ü–∞, —Ä–∏—Å, –æ–≤–æ—â–∏, –π–æ–≥—É—Ä—Ç, –±–∞–Ω–∞–Ω—ã",
      "—Ä—ã–±–∞, –≥—Ä–µ—á–∫–∞, –æ–≤–æ—â–∏, —Ç–≤–æ—Ä–æ–≥, —è–≥–æ–¥—ã",
      "–∏–Ω–¥–µ–π–∫–∞, –∫–∞—Ä—Ç–æ—Ñ–µ–ª—å, –æ–≤–æ—â–∏, —è–π—Ü–∞, —è–±–ª–æ–∫–∏"
    ];

    function simulatePhotoRecognition(file){
      // –º—è–≥–∫–∞—è –∏–º–∏—Ç–∞—Ü–∏—è: –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –∏–ª–∏ —Å–ª—É—á–∞–π–Ω–æ
      const name = (file?.name || "").toLowerCase();
      if(name.includes("egg") || name.includes("—è–π")) return photoSets[0];
      if(name.includes("chick") || name.includes("–∫—É—Ä")) return photoSets[1];
      if(name.includes("fish") || name.includes("—Ä—ã–±")) return photoSets[2];
      return photoSets[Math.floor(Math.random() * photoSets.length)];
    }

    function normalizeList(raw){
      return raw.split(",")
        .map(s => s.trim().toLowerCase())
        .filter(Boolean)
        .slice(0, 30);
    }

    function smartMenuFromList(items){
      const has = (key) => items.some(x => x.includes(key));

      const breakfast =
        has("–æ–≤—Å—è") ? "–û–≤—Å—è–Ω–∫–∞ + —è–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç—ã + —è–π—Ü–æ (–µ—Å–ª–∏ –µ—Å—Ç—å)" :
        has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç + –æ—Ä–µ—Ö–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)" :
        has("—è–π—Ü")  ? "–û–º–ª–µ—Ç + –æ–≤–æ—â–∏" :
        "–ö–∞—à–∞/–π–æ–≥—É—Ä—Ç + —Ñ—Ä—É–∫—Ç";

      const lunch =
        (has("–∫—É—Ä") || has("–∏–Ω–¥–µ–π")) ? "–ë–µ–ª–æ–∫ (–∫—É—Ä–∏—Ü–∞/–∏–Ω–¥–µ–π–∫–∞) + –≥–∞—Ä–Ω–∏—Ä + —Å–∞–ª–∞—Ç" :
        has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏ + –≥–∞—Ä–Ω–∏—Ä (–ø–æ –∂–µ–ª–∞–Ω–∏—é)" :
        has("–≥—Ä–µ—á") || has("—Ä–∏—Å") ? "–ö—Ä—É–ø–∞ + –æ–≤–æ—â–∏ + –±–µ–ª–æ–∫ (—á—Ç–æ –µ—Å—Ç—å)" :
        "–¢—ë–ø–ª–∞—è —Ç–∞—Ä–µ–ª–∫–∞: –±–µ–ª–æ–∫ + –æ–≤–æ—â–∏ + –Ω–µ–º–Ω–æ–≥–æ –≥–∞—Ä–Ω–∏—Ä–∞";

      const snack =
        has("–π–æ–≥—É—Ä") ? "–ô–æ–≥—É—Ä—Ç + —è–≥–æ–¥—ã/—Ñ—Ä—É–∫—Ç" :
        has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —Ñ—Ä—É–∫—Ç" :
        has("–∫–µ—Ñ") ? "–ö–µ—Ñ–∏—Ä/—Ä—è–∂–µ–Ω–∫–∞ + —Ñ—Ä—É–∫—Ç" :
        "–§—Ä—É–∫—Ç + –≤–æ–¥–∞";

      const dinner =
        has("—Ä—ã–±") ? "–†—ã–±–∞ + –æ–≤–æ—â–∏" :
        has("—è–π—Ü") ? "–û–º–ª–µ—Ç/—è–π—Ü–∞ + —Å–∞–ª–∞—Ç" :
        has("—Ç–≤–æ—Ä") ? "–¢–≤–æ—Ä–æ–≥ + —è–≥–æ–¥—ã (–µ—Å–ª–∏ –ø–æ–∑–¥–Ω–æ)" :
        "–û–≤–æ—â–∏ + –ª—ë–≥–∫–∏–π –±–µ–ª–æ–∫";

      return { breakfast, lunch, snack, dinner };
    }

    function renderSmartMenu(title, itemsText, menu){
      $("smartOut").style.display = "block";
      $("smartOut").innerHTML = `
        <div class="dayCard">
          <h3>${safeText(title)}</h3>
          <p class="dayHint">–ù–∞ –æ—Å–Ω–æ–≤–µ: <b>${safeText(itemsText)}</b>. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, —Å–æ—Ö—Ä–∞–Ω—è—è —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–Ω—è.</p>
          <ul class="lines">
            <li><b>ü´ê –ó–∞–≤—Ç—Ä–∞–∫:</b> ${safeText(menu.breakfast)}</li>
            <li><b>üç≤ –û–±–µ–¥:</b> ${safeText(menu.lunch)}</li>
            <li><b>üçè –ü–µ—Ä–µ–∫—É—Å:</b> ${safeText(menu.snack)}</li>
            <li><b>ü•ó –£–∂–∏–Ω:</b> ${safeText(menu.dinner)}</li>
          </ul>
          <div class="pill">ü§ç –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ, —á—Ç–æ —É–∂–µ –µ—Å—Ç—å –¥–æ–º–∞ ‚Äî –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø–æ–∫—É–ø–æ–∫.</div>
        </div>
      `;
    }

    // Events
    document.addEventListener("DOMContentLoaded", () => {
      const calcBtn = $("calcBtn");
      const smartBtn = $("smartMenuBtn");
      const fillFromPhotoBtn = $("fillFromPhotoBtn");
      const photoInput = $("fridgePhoto");

      let recognizedText = "";

      calcBtn.addEventListener("click", () => {
        const model = calculate();
        if(model) renderResults(model);
      });

      $("tabDay").addEventListener("click", () => showTab("day"));
      $("tabWeek").addEventListener("click", () => showTab("week"));

      photoInput.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0] ? e.target.files[0] : null;
        if(!file){ recognizedText = ""; return; }
        recognizedText = simulatePhotoRecognition(file);
      });

      fillFromPhotoBtn.addEventListener("click", () => {
        $("warnSmart").style.display = "none";
        const file = photoInput.files && photoInput.files[0] ? photoInput.files[0] : null;
        if(!file){
          $("warnSmart").style.display = "block";
          $("warnSmart").textContent = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ, –∞ –ø–æ—Ç–æ–º –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª.";
          return;
        }
        if(!recognizedText) recognizedText = simulatePhotoRecognition(file);
        $("products").value = recognizedText;
      });

      smartBtn.addEventListener("click", () => {
        $("warnSmart").style.display = "none";
        const raw = $("products").value.trim();
        if(!raw){
          $("warnSmart").style.display = "block";
          $("warnSmart").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –¥–æ–±–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–ø–æ–ª–Ω–∏—Ç—å –ø–æ —Ñ–æ—Ç–æ¬ª).";
          return;
        }
        const items = normalizeList(raw);
        const menu = smartMenuFromList(items);
        renderSmartMenu("–ú–µ–Ω—é –∏–∑ —Ç–æ–≥–æ, —á—Ç–æ –µ—Å—Ç—å", raw, menu);
      });
    });
  </script>
</body>
</html>
